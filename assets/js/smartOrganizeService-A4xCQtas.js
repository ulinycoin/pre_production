var B=Object.defineProperty;var z=(u,t,i)=>t in u?B(u,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):u[t]=i;var T=(u,t,i)=>z(u,typeof t!="symbol"?t+"":t,i);import{g as L,O as b}from"./vendor-pdfjs-BlOy0ZkI.js";const M=[/^chapter\s+(\d+|[ivxlcdm]+)/i,/^part\s+(\d+|[ivxlcdm]+|one|two|three)/i,/^section\s+(\d+)/i,/^introduction/i,/^preface/i,/^conclusion/i,/^appendix/i,/^index/i,/^Ğ³Ğ»Ğ°Ğ²Ğ°\s+(\d+|[ivxlcdm]+)/i,/^Ñ‡Ğ°ÑÑ‚ÑŒ\s+(\d+|[ivxlcdm]+)/i,/^Ñ€Ğ°Ğ·Ğ´ĞµĞ»\s+(\d+)/i,/^Ğ²Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ/i,/^Ğ¿Ñ€ĞµĞ´Ğ¸ÑĞ»Ğ¾Ğ²Ğ¸Ğµ/i,/^Ğ·Ğ°ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ/i,/^Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ/i,/^kapitel\s+(\d+|[ivxlcdm]+)/i,/^teil\s+(\d+|[ivxlcdm]+)/i,/^einfÃ¼hrung/i,/^einleitung/i,/^anhang/i,/^chapitre\s+(\d+|[ivxlcdm]+)/i,/^partie\s+(\d+|[ivxlcdm]+)/i,/^introduction/i,/^annexe/i,/^capÃ­tulo\s+(\d+|[ivxlcdm]+)/i,/^parte\s+(\d+|[ivxlcdm]+)/i,/^secciÃ³n\s+(\d+)/i,/^introducciÃ³n/i,/^introduÃ§Ã£o/i,/^anexo/i,/^capitolo\s+(\d+|[ivxlcdm]+)/i,/^parte\s+(\d+|[ivxlcdm]+)/i,/^introduzione/i,/^appendice/i,/^(ç¬¬)?\s*(\d+|[é›¶ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åç™¾]+)\s*(ç« |èŠ‚|éƒ¨|ç¯‡)/,/^ç»ªè®º/,/^ã¯ã˜ã‚ã«/,/^å‰è¨€/,/^(\d+)\.\s+/,/^[IVXLCDM]+\.\s+/],D=[/table\s+of\s+contents/i,/contents/i,/Ğ¾Ğ³Ğ»Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ/i,/ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ/i,/inhaltsverzeichnis/i,/sommaire/i,/Ã­ndice/i,/indice/i,/ç›®å½•/,/ç›®æ¬¡/],m=class m{static getInstance(){return this.instance||(this.instance=new m),this.instance}async analyzeDocument(t,i){const e=performance.now();i?.(0,"Loading document...");const n=await t.arrayBuffer(),r=await L({data:n}).promise,a=r.numPages,s=[];for(let c=1;c<=a;c++){i?.(c/a*80,`Analyzing page ${c} of ${a}...`);const p=await this.analyzePage(r,c);s.push(p)}i?.(85,"Detecting duplicates...");const o=this.detectDuplicatePages(s);i?.(90,"Identifying structure...");const d=this.detectChapters(s);i?.(95,"Generating recommendations...");const h=s.filter(c=>c.isBlank).map(c=>c.pageNumber),f=s.filter(c=>c.needsRotation).map(c=>c.pageNumber),g=s.filter(c=>c.isTOC).map(c=>c.pageNumber),x=s.find(c=>c.isCover)?.pageNumber||null,C=h.length+o.reduce((c,p)=>c+p.pages.length-1,0)+f.length;return i?.(100,"Analysis complete!"),{pages:s,blankPages:h,duplicateGroups:o,rotationNeeded:f,chapters:d,tocPages:g,coverPage:x,totalPages:a,issuesCount:C,analysisTime:performance.now()-e}}async analyzePage(t,i){const e=await t.getPage(i),n=e.getViewport({scale:1}),a=(await e.getTextContent()).items,s=a.map(l=>l.str).join(" ").trim(),o=s.length,d=a.map(l=>({text:l.str,x:l.transform[4],y:l.transform[5],fontSize:Math.abs(l.transform[0])||12,width:l.width||0,fontName:l.fontName})),h=d.map(l=>l.fontSize).sort((l,N)=>l-N),f=h.length>0?h[Math.floor(h.length/2)]:12,g=await this.detectImages(e),{isBlank:x,confidence:C}=this.detectBlankPage(o,d,n,g),{needsRotation:c,suggestedRotation:p,isLandscape:w}=this.detectOrientation(d,n),{isChapterStart:v,chapterTitle:k}=this.detectChapterStart(s,d,n,f),P=this.detectTOC(s),O=i===1&&o<500&&!P,R=n.width*n.height,S=Math.min(o/(R/100),1),A=await this.hashContent(s);return{pageNumber:i,isBlank:x,blankConfidence:C,textLength:o,hasImages:g,isChapterStart:v,chapterTitle:k,isTOC:P,isCover:O,needsRotation:c,suggestedRotation:p,isLandscape:w,textDensity:S,contentHash:A}}detectBlankPage(t,i,e,n){if(n)return{isBlank:!1,confidence:0};if(t<10)return{isBlank:!0,confidence:.95};if(i.filter(o=>o.text.trim().length>2&&!/^\d+$/.test(o.text.trim())).length===0)return{isBlank:!0,confidence:.9};const a=e.width*e.height;return t/(a/100)<.01&&t<50?{isBlank:!0,confidence:.7}:{isBlank:!1,confidence:0}}detectOrientation(t,i){const e=i.width>i.height;if(t.length<5)return{needsRotation:!1,suggestedRotation:0,isLandscape:e};const n={minX:Math.min(...t.map(s=>s.x)),maxX:Math.max(...t.map(s=>s.x+(s.width||0))),minY:Math.min(...t.map(s=>s.y)),maxY:Math.max(...t.map(s=>s.y))},r=n.maxX-n.minX,a=n.maxY-n.minY;return e&&a>r*2?{needsRotation:!0,suggestedRotation:90,isLandscape:e}:!e&&r>a*2&&t.length>20?{needsRotation:!0,suggestedRotation:270,isLandscape:e}:{needsRotation:!1,suggestedRotation:0,isLandscape:e}}detectChapterStart(t,i,e,n){const r=this.detectVisualHeader(i,e,n);if(r)return{isChapterStart:!0,chapterTitle:r};const a=t.split(/\n|\r/).slice(0,5).join(" ").trim();for(const s of M)if(s.test(a)){const o=a.match(/^.{0,100}/);if(o){const d=o[0].trim();if(!/\.{3,}\s*\d+$/.test(d))return{isChapterStart:!0,chapterTitle:d}}}return{isChapterStart:!1,chapterTitle:null}}detectVisualHeader(t,i,e){const n=i.height*.6,r=t.filter(o=>o.y>n);if(r.length===0)return null;let a=0,s=null;for(const o of r)o.text.trim().length<2||o.fontSize>a&&(a=o.fontSize,s=o);if(s&&(a>=e*1.3||a>18)){const o=s.text.trim();if(o.length>2&&o.length<100&&(o===o.toUpperCase()&&/[A-Z]/.test(o)||a>=e*1.5))return o}return null}detectTOC(t){const i=t.toLowerCase();for(const r of D)if(r.test(i))return!0;const e=/\d+\s*$/gm,n=t.match(e);return!!(n&&n.length>5&&/\.{3,}|\s{3,}\d+/.test(t))}async detectImages(t){try{const i=await t.getOperatorList(),e=[b.paintImageXObject,b.paintImageXObjectRepeat,b.paintJpegXObject];return i.fnArray.some(n=>e.includes(n))}catch{return!1}}async hashContent(t){const i=t.toLowerCase().replace(/\s+/g," ").trim().slice(0,1e3);if(typeof crypto<"u"&&crypto.subtle){const r=new TextEncoder().encode(i),a=await crypto.subtle.digest("SHA-256",r);return Array.from(new Uint8Array(a)).slice(0,8).map(o=>o.toString(16).padStart(2,"0")).join("")}let e=0;for(let n=0;n<i.length;n++)e=(e<<5)-e+i.charCodeAt(n),e=e&e;return Math.abs(e).toString(16)}detectDuplicatePages(t){const i=[],e=new Set;for(let n=0;n<t.length;n++){if(e.has(n)||t[n].isBlank)continue;const r=[t[n].pageNumber];for(let a=n+1;a<t.length;a++)e.has(a)||t[a].isBlank||(t[n].contentHash===t[a].contentHash?(r.push(t[a].pageNumber),e.add(a)):Math.abs(t[n].textLength-t[a].textLength)<t[n].textLength*.1&&t[n].textLength>100);r.length>1&&(e.add(n),i.push({pages:r,similarity:1}))}return i}detectChapters(t){const i=[];for(let e=0;e<t.length;e++)if(t[e].isChapterStart&&t[e].chapterTitle){let n=null;for(let r=e+1;r<t.length;r++)if(t[r].isChapterStart){n=t[r].pageNumber-1;break}i.push({title:t[e].chapterTitle,startPage:t[e].pageNumber,endPage:n})}return i}generateActions(t,i){const e=[];if(t.blankPages.length>0&&e.push({type:"remove_blank",label:i("smartOrganize.removeBlank")||"Remove Blank Pages",description:`${t.blankPages.length} blank page(s) detected`,affectedPages:t.blankPages,icon:"ğŸ“„"}),t.duplicateGroups.length>0){const n=t.duplicateGroups.flatMap(r=>r.pages.slice(1));e.push({type:"remove_duplicates",label:i("smartOrganize.removeDuplicates")||"Remove Duplicates",description:`${n.length} duplicate page(s) found`,affectedPages:n,icon:"ğŸ”„"})}return t.rotationNeeded.length>0&&e.push({type:"fix_rotation",label:i("smartOrganize.fixRotation")||"Fix Rotation",description:`${t.rotationNeeded.length} page(s) may need rotation`,affectedPages:t.rotationNeeded,icon:"ğŸ”ƒ"}),t.tocPages.length>0&&t.tocPages[0]>2&&e.push({type:"move_toc",label:i("smartOrganize.moveTOC")||"Move TOC to Front",description:"Table of Contents found on later pages",affectedPages:t.tocPages,icon:"ğŸ“‘"}),e}};T(m,"instance");let y=m;const X=y.getInstance();export{X as s};
