var se=Object.defineProperty;var re=(o,t,s)=>t in o?se(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s;var G=(o,t,s)=>re(o,typeof t!="symbol"?t+"":t,s);import{u as Z,r as y,j as e,B as U,a as w,b as ne,p as L,R as Y,M as ie,S as le,c as oe,d as q,F as ce,H as de,t as P}from"./index-ByNlfbxM.js";import{P as me}from"./ProgressBar-CKe5kCn5.js";import{P as pe}from"./PDFPreview-DeEpfSjx.js";import{C as E,a as B,T as K}from"./ToolLayout-CEHQ6Lwh.js";import{g as ge}from"./vendor-pdfjs-BlOy0ZkI.js";import"./vendor-react-CTjRfaZN.js";import"./vendor-pdf-lib-CZHCEpXA.js";import"./vendor-word-CeUssL8V.js";import"./vendor-ocr-CTFn7PEu.js";import"./FileUpload-vqoJmZZ0.js";const ue=[{regex:/(\d{4})-(\d{2})-(\d{2})/,format:"ISO"},{regex:/(\d{1,2})[./](\d{1,2})[./](\d{4})/,format:"EU"},{regex:/(\d{1,2})\/(\d{1,2})\/(\d{4})/,format:"US"},{regex:/(\d{1,2})\s+(January|February|March|April|May|June|July|August|September|October|November|December)\s+(\d{4})/i,format:"WRITTEN_EU"},{regex:/(January|February|March|April|May|June|July|August|September|October|November|December)\s+(\d{1,2}),?\s+(\d{4})/i,format:"WRITTEN_US"},{regex:/(\d{1,2})\s+(—è–Ω–≤–∞—Ä—è|—Ñ–µ–≤—Ä–∞–ª—è|–º–∞—Ä—Ç–∞|–∞–ø—Ä–µ–ª—è|–º–∞—è|–∏—é–Ω—è|–∏—é–ª—è|–∞–≤–≥—É—Å—Ç–∞|—Å–µ–Ω—Ç—è–±—Ä—è|–æ–∫—Ç—è–±—Ä—è|–Ω–æ—è–±—Ä—è|–¥–µ–∫–∞–±—Ä—è)\s+(\d{4})/i,format:"RU"},{regex:/(\d{1,2})\.?\s+(Januar|Februar|M√§rz|April|Mai|Juni|Juli|August|September|Oktober|November|Dezember)\s+(\d{4})/i,format:"DE"},{regex:/(\d{1,2})[./](\d{1,2})[./](\d{2})(?!\d)/,format:"SHORT_YEAR"}],W={january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11,—è–Ω–≤–∞—Ä—è:0,—Ñ–µ–≤—Ä–∞–ª—è:1,–º–∞—Ä—Ç–∞:2,–∞–ø—Ä–µ–ª—è:3,–º–∞—è:4,–∏—é–Ω—è:5,–∏—é–ª—è:6,–∞–≤–≥—É—Å—Ç–∞:7,—Å–µ–Ω—Ç—è–±—Ä—è:8,–æ–∫—Ç—è–±—Ä—è:9,–Ω–æ—è–±—Ä—è:10,–¥–µ–∫–∞–±—Ä—è:11,januar:0,februar:1,m√§rz:2,mai:4,juni:5,juli:6,oktober:9,dezember:11},H=class H{static getInstance(){return this.instance||(this.instance=new H),this.instance}async analyzeDocuments(t,s){const r=performance.now(),a=[];s?.(0,"Starting document analysis...");for(let d=0;d<t.length;d++){const{id:b,file:x}=t[d];s?.((d+1)/t.length*70,`Analyzing ${x.name}...`);try{const g=await this.analyzeDocument(b,x);a.push(g)}catch(g){console.warn(`Failed to analyze ${x.name}:`,g),a.push({fileId:b,fileName:x.name,fileSize:x.size,pageCount:0,dates:[],primaryDate:null,contentHash:"",textSample:"",filenameNumber:this.extractNumberFromFilename(x.name),filenameDate:this.extractDateFromFilename(x.name),metadata:{}})}}s?.(75,"Detecting duplicates...");const i=this.detectDuplicates(a);s?.(85,"Generating suggestions...");const n=this.generateSortSuggestions(a);s?.(95,"Finalizing analysis...");const l=this.generateWarnings(a,i);return s?.(100,"Analysis complete!"),{documents:a,duplicates:i,suggestions:n,warnings:l,analysisTime:performance.now()-r}}async analyzeDocument(t,s){const r=await s.arrayBuffer(),a=await ge({data:r}).promise,n=(await a.getMetadata())?.info||{},l=Math.min(a.numPages,5);let d="";for(let h=1;h<=l;h++){const v=(await(await a.getPage(h)).getTextContent()).items.map(S=>"str"in S?S.str:"").join(" ");d+=v+`
`}const b=this.extractDatesFromText(d),x=this.extractDateFromFilename(s.name);if(x&&b.push({value:x,source:"filename",confidence:.9,context:s.name}),n.CreationDate){const h=this.parsePdfDate(n.CreationDate);h&&b.push({value:h,source:"metadata",confidence:.7,context:"PDF Creation Date"})}b.sort((h,k)=>k.confidence-h.confidence);const g=b.length>0?b[0].value:null,D=d.slice(0,500).trim(),j=await this.hashText(D);return{fileId:t,fileName:s.name,fileSize:s.size,pageCount:a.numPages,dates:b,primaryDate:g,contentHash:j,textSample:D,filenameNumber:this.extractNumberFromFilename(s.name),filenameDate:x,metadata:{title:n.Title||void 0,author:n.Author||void 0,creationDate:n.CreationDate&&this.parsePdfDate(n.CreationDate)||void 0,modificationDate:n.ModDate&&this.parsePdfDate(n.ModDate)||void 0}}}extractDatesFromText(t){const s=[],r=new Set;for(const a of ue){const i=t.matchAll(new RegExp(a.regex,"gi"));for(const n of i)try{const l=this.parseMatchToDate(n,a.format);if(l&&!isNaN(l.getTime())&&!r.has(l.getTime())){const d=l.getFullYear();if(d>=1990&&d<=2100){r.add(l.getTime());const b=Math.max(0,n.index-30),x=Math.min(t.length,n.index+n[0].length+30),g=t.slice(b,x).replace(/\s+/g," ").trim();s.push({value:l,source:"content",confidence:this.calculateDateConfidence(n[0],g),context:g})}}}catch{}}return s}parseMatchToDate(t,s){try{let r,a,i;switch(s){case"ISO":i=parseInt(t[1]),a=parseInt(t[2])-1,r=parseInt(t[3]);break;case"EU":r=parseInt(t[1]),a=parseInt(t[2])-1,i=parseInt(t[3]);break;case"US":a=parseInt(t[1])-1,r=parseInt(t[2]),i=parseInt(t[3]);break;case"WRITTEN_EU":r=parseInt(t[1]),a=W[t[2].toLowerCase()]??0,i=parseInt(t[3]);break;case"WRITTEN_US":a=W[t[1].toLowerCase()]??0,r=parseInt(t[2]),i=parseInt(t[3]);break;case"RU":case"DE":r=parseInt(t[1]),a=W[t[2].toLowerCase()]??0,i=parseInt(t[3]);break;case"SHORT_YEAR":r=parseInt(t[1]),a=parseInt(t[2])-1,i=parseInt(t[3]),i=i<50?2e3+i:1900+i;break;default:return null}return r<1||r>31||a<0||a>11?null:new Date(i,a,r)}catch{return null}}extractDateFromFilename(t){const s=[/(\d{4})-(\d{2})-(\d{2})/,/(\d{4})(\d{2})(\d{2})/,/(\d{2})-(\d{2})-(\d{4})/,/(\d{2})\.(\d{2})\.(\d{4})/];for(const r of s){const a=t.match(r);if(a)if(a[1].length===4){const i=new Date(parseInt(a[1]),parseInt(a[2])-1,parseInt(a[3]));if(!isNaN(i.getTime()))return i}else{const i=new Date(parseInt(a[3]),parseInt(a[2])-1,parseInt(a[1]));if(!isNaN(i.getTime()))return i}}return null}extractNumberFromFilename(t){const s=t.replace(/\.[^/.]+$/,""),r=[/(?:part|chapter|section|page|doc|file|item)[\s_-]*(\d+)/i,/(\d+)[\s_-]*(?:part|chapter|section|page|doc|file|item)/i,/^(\d+)[\s_.-]/,/[\s_.-](\d+)$/,/[_-](\d+)[_-]/];for(const i of r){const n=s.match(i);if(n)return parseInt(n[1])}const a=s.match(/\d+/g);return a&&a.length===1?parseInt(a[0]):null}calculateDateConfidence(t,s){let r=.5;return["date","dated","issued","created","signed","effective","–¥–∞—Ç–∞","datum"].some(i=>s.toLowerCase().includes(i))&&(r+=.2),/[a-zA-Z–∞-—è–ê-–Ø—ë–Å]{3,}/.test(t)&&(r+=.1),/\d{4}/.test(t)&&(r+=.1),Math.min(r,1)}parsePdfDate(t){if(!t)return null;const r=t.replace(/^D:/,"").match(/^(\d{4})(\d{2})(\d{2})(\d{2})?(\d{2})?(\d{2})?/);if(r)return new Date(parseInt(r[1]),parseInt(r[2])-1,parseInt(r[3]),parseInt(r[4]||"0"),parseInt(r[5]||"0"),parseInt(r[6]||"0"));const a=new Date(t);return isNaN(a.getTime())?null:a}async hashText(t){const s=t.toLowerCase().replace(/\s+/g," ").trim();if(typeof crypto<"u"&&crypto.subtle){const i=new TextEncoder().encode(s),n=await crypto.subtle.digest("SHA-256",i);return Array.from(new Uint8Array(n)).map(d=>d.toString(16).padStart(2,"0")).join("")}let r=0;for(let a=0;a<s.length;a++){const i=s.charCodeAt(a);r=(r<<5)-r+i,r=r&r}return r.toString(16)}detectDuplicates(t){const s=[],r=new Set;for(let a=0;a<t.length;a++){if(r.has(t[a].fileId))continue;const i=[t[a].fileId];for(let n=a+1;n<t.length;n++){if(r.has(t[n].fileId))continue;this.calculateSimilarity(t[a],t[n]).score>.8&&(i.push(t[n].fileId),r.add(t[n].fileId))}i.length>1&&(r.add(t[a].fileId),s.push({files:i,similarity:1,reason:"similar_content"}))}return s}calculateSimilarity(t,s){if(t.contentHash&&t.contentHash===s.contentHash)return{score:1,reason:"exact"};const r=Math.min(t.fileSize,s.fileSize)/Math.max(t.fileSize,s.fileSize),a=t.pageCount&&s.pageCount?Math.min(t.pageCount,s.pageCount)/Math.max(t.pageCount,s.pageCount):0,i=this.calculateTextSimilarity(t.textSample,s.textSample);return{score:r*.2+a*.2+i*.6,reason:"similar_content"}}calculateTextSimilarity(t,s){if(!t||!s)return 0;const r=new Set(t.toLowerCase().split(/\s+/).filter(n=>n.length>3)),a=new Set(s.toLowerCase().split(/\s+/).filter(n=>n.length>3));if(r.size===0||a.size===0)return 0;let i=0;for(const n of r)a.has(n)&&i++;return i/(r.size+a.size-i)}generateSortSuggestions(t){const s=[],r=t.filter(n=>n.primaryDate);if(r.length>=t.length*.5){const n=[...t].sort((l,d)=>!l.primaryDate&&!d.primaryDate?0:l.primaryDate?d.primaryDate?l.primaryDate.getTime()-d.primaryDate.getTime():-1:1);s.push({type:"date_asc",label:"Chronological",description:"Sort by date (oldest first)",order:n.map(l=>l.fileId),confidence:r.length/t.length}),s.push({type:"date_desc",label:"Newest First",description:"Sort by date (newest first)",order:[...n].reverse().map(l=>l.fileId),confidence:r.length/t.length})}const a=t.filter(n=>n.filenameNumber!==null);if(a.length>=t.length*.5){const n=[...t].sort((l,d)=>l.filenameNumber===null&&d.filenameNumber===null?0:l.filenameNumber===null?1:d.filenameNumber===null?-1:l.filenameNumber-d.filenameNumber);s.push({type:"filename",label:"By Filename",description:"Sort by numbers in filenames",order:n.map(l=>l.fileId),confidence:a.length/t.length})}const i=[...t].sort((n,l)=>l.fileSize-n.fileSize);return s.push({type:"size",label:"By Size",description:"Sort by file size (largest first)",order:i.map(n=>n.fileId),confidence:.3}),s.sort((n,l)=>l.confidence-n.confidence)}generateWarnings(t,s){const r=[];for(const n of s)r.push({type:"duplicate",message:`${n.files.length} files appear to be duplicates or very similar`,fileIds:n.files,severity:"warning"});const a=t.filter(n=>!n.primaryDate);a.length>t.length*.5&&r.push({type:"no_dates",message:"Most documents have no detectable dates for smart sorting",fileIds:a.map(n=>n.fileId),severity:"info"});const i=t.filter(n=>n.fileSize>50*1024*1024);return i.length>0&&r.push({type:"large_file",message:`${i.length} file(s) are larger than 50MB`,fileIds:i.map(n=>n.fileId),severity:"info"}),r}applySortSuggestion(t,s){const r=new Map(t.map(a=>[a.id,a]));return s.order.map(a=>r.get(a)).filter(a=>a!==void 0)}formatDate(t,s="en"){return t.toLocaleDateString(s,{year:"numeric",month:"short",day:"numeric"})}};G(H,"instance");let J=H;const Q=J.getInstance(),he=({files:o,onApplySort:t,onRemoveDuplicates:s})=>{const{t:r,language:a}=Z(),[i,n]=y.useState(null),[l,d]=y.useState(!1),[b,x]=y.useState(null),[g,D]=y.useState("suggestions"),[j,h]=y.useState(!0);y.useEffect(()=>{if(o.length<2||!j){n(null);return}const N=setTimeout(async()=>{d(!0),x(null);try{const I=await Q.analyzeDocuments(o.map(z=>({id:z.id,file:z.file})));n(I)}catch(I){console.error("Analysis failed:",I),x("Failed to analyze documents")}finally{d(!1)}},500);return()=>clearTimeout(N)},[o,j]);const k=p=>{t(p.order)},F=p=>{const N=p.slice(1);s?.(N)};if(o.length<2)return null;const v=()=>e.jsx("button",{onClick:()=>h(!j),className:`relative inline-flex h-5 w-9 items-center rounded-full transition-colors ${j?"bg-ocean-500":"bg-gray-300 dark:bg-gray-600"}`,"aria-label":j?"Disable Smart Merge":"Enable Smart Merge",children:e.jsx("span",{className:`inline-block h-3.5 w-3.5 transform rounded-full bg-white transition-transform ${j?"translate-x-5":"translate-x-1"}`})});if(!j)return e.jsx(E,{className:"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:e.jsx(B,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 opacity-60",children:[e.jsx("span",{className:"text-base",children:"üß†"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:r("smartMerge.title")||"Smart Merge"}),e.jsx(U,{variant:"secondary",className:"text-[10px] bg-gray-400 text-white",children:"AI"})]}),e.jsx(v,{})]})})});if(l)return e.jsx(E,{className:"border-ocean-400/50 dark:border-ocean-500/30 bg-white dark:bg-gray-800/90",children:e.jsx(B,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-ocean-500 border-t-transparent rounded-full"}),e.jsx("span",{className:"text-sm text-ocean-700 dark:text-ocean-300",children:r("smartMerge.analyzing")||"Analyzing documents..."})]}),e.jsx(v,{})]})})});if(b)return e.jsx(E,{className:"border-amber-200 dark:border-amber-800 bg-amber-50/50 dark:bg-amber-950/30",children:e.jsx(B,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:b}),e.jsx(v,{})]})})});if(!i)return null;const{suggestions:S,duplicates:T,warnings:R,documents:A}=i;return S.length>0||T.length>0?e.jsx(E,{className:"border-ocean-400/50 dark:border-ocean-500/30 bg-white dark:bg-gray-800/90 shadow-sm",children:e.jsxs(B,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üß†"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:r("smartMerge.title")||"Smart Merge"}),e.jsx(U,{variant:"secondary",className:"text-xs bg-ocean-500 text-white",children:"AI"}),e.jsxs("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:[Math.round(i.analysisTime),"ms"]})]}),e.jsx(v,{})]}),R.length>0&&e.jsx("div",{className:"space-y-2",children:R.map((p,N)=>e.jsxs("div",{className:`flex items-start gap-2 p-2 rounded-lg text-sm ${p.severity==="warning"?"bg-amber-100/80 dark:bg-amber-900/30 text-amber-800 dark:text-amber-200":"bg-blue-100/80 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200"}`,children:[e.jsx("span",{children:p.severity==="warning"?"‚ö†Ô∏è":"‚ÑπÔ∏è"}),e.jsx("span",{children:p.message})]},N))}),S.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>D(g==="suggestions"?null:"suggestions"),className:"flex items-center justify-between w-full text-left py-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:r("smartMerge.sortSuggestions")||"Sort Suggestions"}),e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:g==="suggestions"?"‚ñº":"‚ñ∂"})]}),g==="suggestions"&&e.jsx("div",{className:"grid grid-cols-1 gap-3",children:S.map((p,N)=>e.jsx(w,{variant:"outline",size:"sm",onClick:()=>k(p),className:"justify-start h-auto py-3 px-4 bg-gray-50 dark:bg-gray-700/50 border-gray-200 dark:border-gray-600 hover:bg-ocean-50 dark:hover:bg-ocean-900/30 hover:border-ocean-400 dark:hover:border-ocean-500 transition-colors",children:e.jsxs("div",{className:"flex flex-col items-start gap-1 w-full",children:[e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsxs("span",{className:"text-base",children:[p.type==="date_asc"&&"üìÖ",p.type==="date_desc"&&"üìÖ",p.type==="filename"&&"üî¢",p.type==="size"&&"üìä"]}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:fe(p.type,a)}),p.confidence>.7&&e.jsxs(U,{className:"ml-auto text-[10px] bg-green-500 text-white border-0",children:[Math.round(p.confidence*100),"%"]})]}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:xe(p.type,a)})]})},N))})]}),T.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>D(g==="duplicates"?null:"duplicates"),className:"flex items-center justify-between w-full text-left",children:[e.jsx("span",{className:"text-sm font-medium text-amber-700 dark:text-amber-300",children:r("smartMerge.duplicatesFound")||"Possible Duplicates Found"}),e.jsx("span",{className:"text-gray-400",children:g==="duplicates"?"‚ñº":"‚ñ∂"})]}),g==="duplicates"&&e.jsx("div",{className:"space-y-2",children:T.map((p,N)=>{const I=p.files.map(z=>o.find(C=>C.id===z)).filter(Boolean);return e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:[I.length," ",r("smartMerge.similarFiles")||"similar files",":"]}),e.jsx("ul",{className:"text-xs text-amber-700 dark:text-amber-300 space-y-0.5",children:I.map((z,C)=>e.jsxs("li",{className:"truncate max-w-[200px]",children:["‚Ä¢ ",z?.name]},C))})]}),s&&e.jsx(w,{variant:"outline",size:"sm",onClick:()=>F(p.files),className:"text-xs border-amber-300 dark:border-amber-700 text-amber-700 dark:text-amber-300 hover:bg-amber-100 dark:hover:bg-amber-900/50",children:r("smartMerge.keepFirst")||"Keep First"})]})},N)})})]}),A.some(p=>p.primaryDate)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>D(g==="dates"?null:"dates"),className:"flex items-center justify-between w-full text-left py-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:r("smartMerge.detectedDates")||"Detected Dates"}),e.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:g==="dates"?"‚ñº":"‚ñ∂"})]}),g==="dates"&&e.jsx("div",{className:"grid grid-cols-2 gap-2",children:A.filter(p=>p.primaryDate).map((p,N)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-gray-700/50 rounded-lg text-xs border border-gray-200 dark:border-gray-600",children:[e.jsx("span",{className:"text-gray-400",children:"üìÑ"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"truncate text-gray-700 dark:text-gray-200",children:p.fileName}),e.jsx("p",{className:"text-ocean-600 dark:text-ocean-400 font-medium",children:Q.formatDate(p.primaryDate,a)})]})]},N))})]})]})}):null};function fe(o,t){const s={date_asc:{en:"Chronological",ru:"–•—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏",de:"Chronologisch",fr:"Chronologique",es:"Cronol√≥gico"},date_desc:{en:"Newest First",ru:"–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ",de:"Neueste zuerst",fr:"Plus r√©cent",es:"M√°s reciente"},filename:{en:"By Filename",ru:"–ü–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞",de:"Nach Dateiname",fr:"Par nom",es:"Por nombre"},size:{en:"By Size",ru:"–ü–æ —Ä–∞–∑–º–µ—Ä—É",de:"Nach Gr√∂√üe",fr:"Par taille",es:"Por tama√±o"}};return s[o]?.[t]||s[o]?.en||o}function xe(o,t){const s={date_asc:{en:"Oldest first",ru:"–û—Ç —Å—Ç–∞—Ä—ã—Ö –∫ –Ω–æ–≤—ã–º",de:"√Ñlteste zuerst",fr:"Du plus ancien",es:"Del m√°s antiguo"},date_desc:{en:"Newest first",ru:"–û—Ç –Ω–æ–≤—ã—Ö –∫ —Å—Ç–∞—Ä—ã–º",de:"Neueste zuerst",fr:"Du plus r√©cent",es:"Del m√°s reciente"},filename:{en:"By numbers in names",ru:"–ü–æ –Ω–æ–º–µ—Ä–∞–º –≤ –∏–º–µ–Ω–∞—Ö",de:"Nach Nummern",fr:"Par num√©ros",es:"Por n√∫meros"},size:{en:"Largest first",ru:"–ë–æ–ª—å—à–∏–µ –ø–µ—Ä–≤—ã–º–∏",de:"Gr√∂√üte zuerst",fr:"Plus grands",es:"M√°s grandes"}};return s[o]?.[t]||s[o]?.en||""}const ze=()=>{const{t:o}=Z(),{setSharedFile:t,sharedFile:s,sharedFiles:r,clearSharedFile:a,clearSharedFiles:i}=ne(),[n,l]=y.useState([]),[d,b]=y.useState(!1),[x,g]=y.useState(0),[D,j]=y.useState(""),[h,k]=y.useState(null),[F,v]=y.useState(null),[S,T]=y.useState(!1),[R,A]=y.useState(!1),M=y.useCallback(async(c,m=!1)=>{const u=c.map((f,_)=>({id:`${Date.now()}-${_}`,file:f,name:f.name,size:f.size,status:"pending"}));l(f=>m?u:[...f,...u]);for(const f of u)try{const _=await L.getPDFInfo(f.file);l(O=>O.map($=>$.id===f.id?{...$,info:_,status:"completed"}:$))}catch{l(_=>_.map(O=>O.id===f.id?{...O,status:"error",error:"Failed to read PDF"}:O))}},[]);Y.useEffect(()=>{if(!S){if(r&&r.files.length>0){const c=r.files.filter(m=>m.name.toLowerCase().endsWith(".pdf")||m.blob.type==="application/pdf").map(m=>new File([m.blob],m.name,{type:m.blob.type}));c.length>0&&M(c,!0),i(),T(!0);return}if(s){if(s.name.toLowerCase().endsWith(".pdf")||s.blob.type==="application/pdf"){const m=new File([s.blob],s.name,{type:s.blob.type});M([m],!0)}a(),T(!0)}}},[r,s,S,i,a,M]),Y.useEffect(()=>{h?.blob&&!d&&!R&&(t(h.blob,"merged.pdf","merge-pdf"),A(!0))},[h,d,R,t]);const p=c=>{l(m=>m.filter(u=>u.id!==c))},N=async()=>{if(n.length<2){P.error(o("merge.errors.minFiles"));return}b(!0),g(0),k(null),A(!1);try{const c=n.map(u=>u.file),m=await L.mergePDFs(c,(u,f)=>{g(u),j(f)});m.success&&m.data?(k({blob:m.data,metadata:m.metadata}),P.success(o("merge.success.title"))):P.error(m.error?.message||"Merge failed")}catch{P.error("An error occurred during merge")}finally{b(!1)}},I=()=>{h?.blob&&L.downloadFile(h.blob,"merged.pdf")},z=()=>{l([]),k(null),A(!1),g(0),j("")},C=c=>{h?.blob&&t(h.blob,"merged.pdf","merge-pdf"),window.location.hash=de[c]},V=c=>{v(c)},X=(c,m)=>{if(c.preventDefault(),F===null||F===m)return;const u=[...n],f=u[F];u.splice(F,1),u.splice(m,0,f),l(u),v(m)},ee=()=>{v(null)},te=c=>{const m=new Map(n.map(f=>[f.id,f])),u=c.map(f=>m.get(f)).filter(f=>f!==void 0);l(u),P.success(o("smartMerge.sortApplied")||"Sort applied")},ae=c=>{l(m=>m.filter(u=>!c.includes(u.id))),P.success(o("smartMerge.duplicatesRemoved")||`${c.length} duplicate(s) removed`)};return h?e.jsx(K,{title:o("tools.merge-pdf.name"),description:o("tools.merge-pdf.description"),hasFiles:!0,onUpload:M,actions:e.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[e.jsx(w,{onClick:I,size:"lg",className:"w-full bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-500/20",children:o("common.download")}),e.jsx(w,{onClick:z,variant:"outline",className:"w-full",children:o("merge.mergeAnother")})]}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(E,{className:"bg-green-50/50 dark:bg-green-900/10 border-green-200 dark:border-green-800 backdrop-blur-sm",children:e.jsxs(B,{className:"p-8 text-center space-y-4",children:[e.jsx("div",{className:"text-6xl mb-4 animate-scale-in",children:"‚úÖ"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:o("merge.success.title")}),e.jsxs("div",{className:"text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("p",{children:[o("merge.success.pages"),": ",e.jsx("span",{className:"font-semibold",children:h.metadata?.pageCount})]}),e.jsxs("p",{children:[o("merge.success.size"),": ",e.jsx("span",{className:"font-semibold",children:L.formatFileSize(h.metadata?.processedSize||0)})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(w,{onClick:()=>C("compress-pdf"),variant:"outline",className:"h-auto py-4 flex flex-col gap-2 hover:border-ocean-400 hover:bg-ocean-50 dark:hover:bg-ocean-900/10",children:[e.jsx(ie,{className:"h-6 w-6 text-ocean-500"}),e.jsx("span",{children:o("tools.compress-pdf.name")})]}),e.jsxs(w,{onClick:()=>C("protect-pdf"),variant:"outline",className:"h-auto py-4 flex flex-col gap-2 hover:border-ocean-400 hover:bg-ocean-50 dark:hover:bg-ocean-900/10",children:[e.jsx(le,{className:"h-6 w-6 text-ocean-500"}),e.jsx("span",{children:o("tools.protect-pdf.name")})]}),e.jsxs(w,{onClick:()=>C("watermark-pdf"),variant:"outline",className:"h-auto py-4 flex flex-col gap-2 hover:border-ocean-400 hover:bg-ocean-50 dark:hover:bg-ocean-900/10",children:[e.jsx(oe,{className:"h-6 w-6 text-ocean-500"}),e.jsx("span",{children:o("tools.watermark-pdf.name")})]}),e.jsxs(w,{onClick:()=>C("split-pdf"),variant:"outline",className:"h-auto py-4 flex flex-col gap-2 hover:border-ocean-400 hover:bg-ocean-50 dark:hover:bg-ocean-900/10",children:[e.jsx(q,{className:"h-6 w-6 text-ocean-500"}),e.jsx("span",{children:o("tools.split-pdf.name")})]})]})]})}):e.jsxs(K,{title:o("tools.merge-pdf.name"),description:o("tools.merge-pdf.description"),hasFiles:n.length>0,isProcessing:d,onUpload:c=>M(c,!1),uploadTitle:o("upload.selectFiles"),uploadDescription:o("upload.multipleFilesAllowed"),settings:n.length>=2?e.jsx("div",{className:"space-y-6 animate-slide-up",children:e.jsx(he,{files:n.map(c=>({id:c.id,file:c.file,name:c.name})),onApplySort:te,onRemoveDuplicates:ae})}):null,actions:e.jsxs("div",{className:"space-y-4",children:[e.jsx(w,{onClick:N,disabled:d||n.length<2,className:"w-full text-lg py-6 shadow-lg shadow-ocean-500/20 bg-ocean-500 hover:bg-ocean-600 text-white",size:"lg",children:o("merge.mergeButton")}),n.length>0&&n.length<2&&e.jsx("p",{className:"text-sm text-center text-gray-500 animate-pulse",children:o("merge.minFilesHint")})]}),children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-6",children:[n.map((c,m)=>e.jsx("div",{draggable:!d,onDragStart:()=>V(m),onDragOver:u=>X(u,m),onDragEnd:ee,className:`relative group ${d?"":"cursor-move"} ${F===m?"opacity-50":""}`,children:e.jsxs(E,{className:"p-4 hover:shadow-medium transition-all duration-200 relative group h-full border-transparent hover:border-ocean-200 dark:hover:border-ocean-800 bg-white dark:bg-privacy-800",children:[e.jsx("div",{className:"mb-4 flex justify-center bg-gray-50 dark:bg-gray-900 rounded-lg p-4",children:e.jsx(pe,{file:c.file,width:180,height:240})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(U,{variant:"secondary",className:"w-8 h-8 p-0 flex items-center justify-center bg-white dark:bg-gray-700 shadow-sm text-sm",children:m+1}),c.info&&e.jsxs("span",{className:"text-sm text-gray-500 font-medium",children:[c.info.pages," pages"]})]}),e.jsx("p",{className:"text-sm font-medium truncate text-gray-900 dark:text-gray-100",title:c.name,children:c.name})]}),!d&&e.jsx("div",{className:"absolute top-2 right-2 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity bg-white/90 dark:bg-black/50 rounded-lg p-1 backdrop-blur-sm shadow-sm",children:e.jsxs(w,{size:"icon",variant:"ghost",className:"h-6 w-6 text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30",onClick:u=>{u.stopPropagation(),p(c.id)},children:[e.jsx("span",{className:"sr-only",children:"Remove"}),e.jsx(q,{className:"h-3 w-3"})]})})]})},c.id)),e.jsx("div",{className:"h-full min-h-[200px]",children:e.jsxs("label",{className:"cursor-pointer h-full border-2 border-dashed border-gray-200 dark:border-privacy-700 hover:border-ocean-400 dark:hover:border-ocean-500 rounded-xl flex flex-col items-center justify-center p-4 transition-all hover:bg-ocean-50/50 dark:hover:bg-ocean-900/10 group",children:[e.jsx("input",{type:"file",multiple:!0,accept:".pdf",className:"hidden",onChange:c=>c.target.files&&M(Array.from(c.target.files),!1)}),e.jsx("div",{className:"w-12 h-12 rounded-full bg-ocean-100 dark:bg-ocean-900/50 flex items-center justify-center mb-2 text-ocean-600 dark:text-ocean-400 text-2xl group-hover:scale-110 transition-transform",children:e.jsx(ce,{className:"h-6 w-6"})}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Add File"})]})})]}),d&&e.jsx("div",{className:"mt-8",children:e.jsx(me,{progress:x,message:D})})]})};export{ze as MergePDF};
