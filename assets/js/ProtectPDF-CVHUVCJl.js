import{e as se,u as te,b as ne,r as i,l as ie,j as e,a as x,m as oe,L as l,S as re,n as ae,k as A}from"./index-BaqsOxPK.js";import{C as f}from"./checkbox-tiR4FlQJ.js";import{T as le}from"./ToolLayout-pcKgwv4w.js";import{F as ce}from"./file-check-D-BD-XOT.js";import{E as T}from"./eye-C3xZTV_n.js";import"./vendor-react-CTjRfaZN.js";import"./vendor-pdfjs-BlOy0ZkI.js";import"./vendor-pdf-lib-CZHCEpXA.js";import"./vendor-word-CeUssL8V.js";import"./vendor-ocr-CTFn7PEu.js";import"./index-BcRrjoDw.js";import"./FileUpload-DUSj1Bnl.js";const de=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],U=se("eye-off",de),Ne=()=>{const{t}=te(),{sharedFile:h,clearSharedFile:F}=ne(),[r,C]=i.useState(null),[a,y]=i.useState(""),[j,b]=i.useState(""),[w,D]=i.useState(!1),[v,I]=i.useState(!1),[N,M]=i.useState(!1),[c,B]=i.useState(!1),[O,$]=i.useState("aes256"),[d,u]=i.useState({printing:"highResolution",modifying:!1,copying:!1,annotating:!1,fillingForms:!0,contentAccessibility:!0,documentAssembly:!1}),[_,H]=i.useState("business"),[P,Z]=i.useState(!1),[g,R]=i.useState(null),[S,L]=i.useState(!1),[p,k]=i.useState(null),[E,m]=i.useState(null);i.useEffect(()=>{if(h&&!r){const s=new File([h.blob],h.name,{type:"application/pdf"});z([s]),F()}},[h,r,F]);const q=s=>{if(H(s),s==="custom")return;const o={basic:{printing:"highResolution",modifying:!1,copying:!0,annotating:!0,fillingForms:!0,level:"aes128"},business:{printing:"highResolution",modifying:!1,copying:!1,annotating:!1,fillingForms:!0,level:"aes256"},confidential:{printing:"none",modifying:!1,copying:!1,annotating:!1,fillingForms:!1,level:"aes256"}}[s];u(ee=>({...ee,printing:o.printing,modifying:o.modifying,copying:o.copying,annotating:o.annotating,fillingForms:o.fillingForms})),$(o.level)},V=s=>{let n=0;const o=[];return s.length>=8?n++:o.push("tooShort"),s.length>=12&&n++,/[a-z]/.test(s)&&/[A-Z]/.test(s)&&n++,/[0-9]/.test(s)&&n++,/[^a-zA-Z0-9]/.test(s)&&n++,{score:Math.min(4,Math.floor(n)),feedback:o,isValid:s.length>=6}};i.useEffect(()=>{R(a?V(a):null)},[a]);const z=async s=>{if(s.length>0){const n=s[0];let o;try{o=await ie(n)}catch{}C({id:Date.now().toString(),file:n,name:n.name,size:n.size,status:"completed",info:o}),m(null),k(null)}},G=async()=>{if(r){if(!c&&!a){m(t("protect.errors.passwordRequired"));return}L(!0),m(null);try{const s={userPassword:c?"":a,ownerPassword:c?"owner-only-restrictions":N&&j?j:a,encryption:O,permissions:d},n=await ae(r.file,s,()=>{}),o=new Blob([n],{type:"application/pdf"});k({blob:o,filename:r.name.replace(".pdf","_protected.pdf"),metadata:{encryption:O,hasPassword:!c}})}catch(s){m(s instanceof Error?s.message:"Protection failed")}finally{L(!1)}}},J=()=>{if(!p)return;const s=URL.createObjectURL(p.blob),n=document.createElement("a");n.href=s,n.download=p.filename,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)},K=()=>{C(null),k(null),y(""),b(""),m(null)},Q=()=>e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx(l,{children:t("protect.userPassword")}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx(A,{type:w?"text":"password",value:a,onChange:s=>y(s.target.value),className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>D(!w),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",children:w?e.jsx(U,{className:"w-4 h-4"}):e.jsx(T,{className:"w-4 h-4"})})]}),g&&e.jsx("div",{className:"mt-2 flex gap-1",children:[0,1,2,3,4].map(s=>e.jsx("div",{className:`h-1 flex-1 rounded-full ${s<=g.score?g.score<2?"bg-red-500":g.score<3?"bg-yellow-500":"bg-green-500":"bg-gray-200"}`},s))})]}),e.jsxs("div",{className:"pt-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(f,{id:"owner",checked:N,onCheckedChange:s=>M(s)}),e.jsx(l,{htmlFor:"owner",children:t("protect.useOwnerPassword")})]}),N&&e.jsxs("div",{className:"relative",children:[e.jsx(A,{type:v?"text":"password",value:j,onChange:s=>b(s.target.value),placeholder:t("protect.ownerPasswordPlaceholder")}),e.jsx("button",{type:"button",onClick:()=>I(!v),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500",children:v?e.jsx(U,{className:"w-4 h-4"}):e.jsx(T,{className:"w-4 h-4"})})]})]})]}),W=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"})," ",t("protect.securityLevel")]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:["basic","business","confidential"].map(s=>e.jsxs("div",{onClick:()=>q(s),className:`cursor-pointer border rounded-lg p-3 transition-colors ${_===s?"bg-ocean-50 border-ocean-500 dark:bg-ocean-900/20":"hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:[e.jsx("div",{className:"font-medium text-sm capitalize",children:t(`protect.presets.${s}.name`)}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:t(`protect.presets.${s}.description`)})]},s))})]}),e.jsxs("div",{className:"flex items-center gap-2 py-2 border-t border-b border-gray-100 dark:border-gray-800",children:[e.jsx(f,{id:"perm-only",checked:c,onCheckedChange:s=>{B(s),s&&(y(""),b(""))}}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"perm-only",className:"cursor-pointer",children:t("protect.permissionsOnly")}),e.jsx("p",{className:"text-xs text-gray-500",children:t("protect.permissionsOnlyHint")})]})]}),!c&&Q(),e.jsxs(x,{variant:"outline",size:"sm",className:"w-full",onClick:()=>Z(!P),children:[t(P?"common.hide":"common.show")," ",t("protect.advancedSettings")]}),P&&e.jsxs("div",{className:"space-y-3 animate-in fade-in slide-in-from-top-1",children:[e.jsx(l,{className:"text-xs uppercase text-gray-500 font-bold",children:t("protect.permissionsTitle")}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{children:t("protect.permissions.printing")}),e.jsxs("select",{value:d.printing,onChange:s=>u({...d,printing:s.target.value}),className:"text-sm border rounded",children:[e.jsx("option",{value:"none",children:t("protect.permissions.printingNone")}),e.jsx("option",{value:"lowResolution",children:t("protect.permissions.printingLow")}),e.jsx("option",{value:"highResolution",children:t("protect.permissions.printingHigh")})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{children:t("protect.permissions.copying")}),e.jsx(f,{checked:d.copying,onCheckedChange:s=>u({...d,copying:!!s})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{children:t("protect.permissions.modifying")}),e.jsx(f,{checked:d.modifying,onCheckedChange:s=>u({...d,modifying:!!s})})]})]})]})]}),X=()=>r?p?e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto text-green-600",children:e.jsx(ce,{className:"w-10 h-10"})}),e.jsx("h2",{className:"text-2xl font-bold",children:t("protect.success.title")}),e.jsxs("p",{className:"text-gray-500",children:[t("protect.success.encryption"),": ",String(p.metadata.encryption)]}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(x,{onClick:J,size:"lg",className:"bg-green-600 hover:bg-green-700",children:t("common.download")}),e.jsx(x,{onClick:K,variant:"outline",size:"lg",children:t("protect.protectAnother")})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx("div",{className:"w-20 h-20 bg-blue-100 dark:bg-blue-900/30 rounded-2xl flex items-center justify-center text-blue-600 dark:text-blue-400",children:e.jsx(oe,{className:"w-10 h-10"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-xl font-bold",children:r.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(r.size/1024/1024).toFixed(2)," MB"]}),r.info&&e.jsxs("p",{className:"text-sm text-gray-500",children:[r.info.pages," pages"]})]}),E&&e.jsx("div",{className:"text-red-500 bg-red-50 px-4 py-2 rounded",children:E})]}):null,Y=()=>e.jsx(x,{onClick:G,disabled:S||!c&&!a,className:"w-full py-6 text-lg font-bold",children:t(S?"common.processing":"protect.protectButton")});return e.jsx(le,{title:t("tools.protect-pdf.name"),description:t("tools.protect-pdf.description"),hasFiles:!!r,onUpload:z,isProcessing:S,maxFiles:1,uploadTitle:t("common.selectFile"),uploadDescription:t("upload.singleFileAllowed"),acceptedTypes:".pdf",settings:p?null:W(),actions:p?null:Y(),children:X()})};export{Ne as ProtectPDF};
