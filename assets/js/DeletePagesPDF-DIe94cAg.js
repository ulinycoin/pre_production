import{u as te,b as re,r as o,p as y,j as e,t as u,K as le,a as m,B as ne,X as oe,Q as B,U as R,L as ie,k as de,V as ce}from"./index-BaqsOxPK.js";import{T as me,C as M}from"./ToolLayout-pcKgwv4w.js";import{P as ge}from"./ProgressBar-fsNAZHx0.js";import{u as xe}from"./usePDFThumbnails-DmbB4CMY.js";import{C as pe}from"./checkbox-tiR4FlQJ.js";import{S as he}from"./square-check-big-DMLraRHA.js";import{S as ue}from"./square-BEhVwQvH.js";import{Z as fe}from"./zoom-in-BLBJcUI6.js";import"./vendor-react-CTjRfaZN.js";import"./vendor-pdfjs-BlOy0ZkI.js";import"./vendor-pdf-lib-CZHCEpXA.js";import"./vendor-word-CeUssL8V.js";import"./vendor-ocr-CTFn7PEu.js";import"./FileUpload-DUSj1Bnl.js";import"./index-BcRrjoDw.js";const Ee=()=>{const{t:r}=te(),{sharedFile:f,clearSharedFile:C,setSharedFile:F}=re(),[l,p]=o.useState(null),[h,z]=o.useState(!1),[U,k]=o.useState(0),[O,D]=o.useState(""),[d,v]=o.useState(null),[I,P]=o.useState(!1),[g,x]=o.useState(new Set),[S,b]=o.useState(""),[N,A]=o.useState(null),[E,T]=o.useState(null),[q,Z]=o.useState(!1),{thumbnails:H,isLoading:K}=xe({file:l?.file,thumbnailWidth:200,thumbnailHeight:280});o.useEffect(()=>{if(f&&!l&&!d){const s=new File([f.blob],f.name,{type:"application/pdf"}),a={id:`${Date.now()}`,file:s,name:f.name,size:s.size,status:"pending"};p(a),y.getPDFInfo(s).then(t=>{p(n=>n?{...n,info:t,status:"completed"}:null)}).catch(()=>{p(t=>t?{...t,status:"error",error:"Failed to read PDF"}:null)}),C()}},[f,l,d,C]),o.useEffect(()=>{if(d&&!h&&!I){const s=l?.name.replace(/\.pdf$/i,"_deleted_pages.pdf")||"deleted_pages.pdf";F(d,s,"delete-pages-pdf"),P(!0)}},[d,h,I,l?.name,F]),o.useEffect(()=>{const s=Array.from(g).sort((a,t)=>a-t);s.length>0?b(s.join(", ")):b("")},[g]),o.useEffect(()=>{(async()=>{if(N!==null&&l?.file){Z(!0),T(null);try{const a=await y.renderPageAsImage(l.file,N,2.5);T(a)}catch(a){console.error("Failed to load zoomed image",a),u.error(r("common.error"))}finally{Z(!1)}}})()},[N,l,r]);const Q=async s=>{const a=s[0];if(!a)return;const t={id:`${Date.now()}`,file:a,name:a.name,size:a.size,status:"pending"};p(t),x(new Set),b("");try{const n=await y.getPDFInfo(a);p(i=>i?{...i,info:n,status:"completed"}:null)}catch{p(n=>n?{...n,status:"error",error:"Failed to read PDF"}:null)}},L=s=>{x(a=>{const t=new Set(a);return t.has(s)?t.delete(s):t.add(s),t})},V=()=>{const s=l?.info?.pages||0;g.size===s?x(new Set):x(new Set(Array.from({length:s},(a,t)=>t+1)))},W=()=>{const s=l?.info?.pages||0,a=Array.from({length:s},(t,n)=>n+1).filter(t=>t%2!==0);x(new Set(a))},X=()=>{const s=l?.info?.pages||0,a=Array.from({length:s},(t,n)=>n+1).filter(t=>t%2===0);x(new Set(a))},_=(s,a)=>{const t=new Set,n=s.split(/[, ]+/).map(i=>i.trim());for(const i of n)if(i.includes("-")){const[c,$]=i.split("-").map(j=>parseInt(j.trim()));if(!isNaN(c)&&!isNaN($))for(let j=Math.max(1,c);j<=Math.min(a,$);j++)t.add(j)}else{const c=parseInt(i);!isNaN(c)&&c>=1&&c<=a&&t.add(c)}return Array.from(t).sort((i,c)=>i-c)},G=async()=>{if(!l)return;const s=l.info?.pages||0,a=_(S,s);if(a.length===0){u.error(r("deletePages.invalidPages"));return}if(a.length>=s){u.error(r("deletePages.cannotDeleteAll"));return}z(!0),k(0),v(null),P(!1);try{const t=await y.deletePDF(l.file,a,(n,i)=>{k(n),D(i)});t.success&&t.data?(v(t.data),u.success(r("deletePages.success"))):u.error(r("deletePages.failed"))}catch(t){u.error(r("deletePages.failed")),console.error(t)}finally{z(!1)}},J=()=>{if(!d||!l)return;const s=l.name.replace(/\.pdf$/i,"_pages-deleted.pdf");y.downloadFile(d,s)},Y=()=>{p(null),v(null),P(!1),k(0),D(""),b(""),x(new Set)},w=l?.info?.pages||1,ee=()=>l?d?e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-2 border-green-200 dark:border-green-800 rounded-2xl p-8 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 dark:bg-green-900/50 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(le,{className:"w-10 h-10 text-green-600 dark:text-green-400"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r("deletePages.success")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:r("deletePages.successDescription")})]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(m,{onClick:J,size:"lg",className:"bg-green-600 hover:bg-green-700 text-white shadow-lg hover:shadow-xl transition-all",children:r("common.download")}),e.jsx(m,{onClick:Y,variant:"outline",size:"lg",children:r("deletePages.deleteAnother")})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 bg-white dark:bg-gray-800 p-3 rounded-xl border border-gray-100 dark:border-gray-700 sticky top-0 z-20 shadow-sm backdrop-blur-md bg-white/80 dark:bg-gray-800/80",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m,{variant:"ghost",size:"sm",onClick:V,className:"h-9 gap-2",children:[g.size===w?e.jsx(he,{className:"w-4 h-4 text-ocean-500"}):e.jsx(ue,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:r("common.selectAll")})]}),e.jsx("div",{className:"h-4 w-px bg-gray-200 dark:bg-gray-700 hidden sm:block"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(m,{variant:"ghost",size:"sm",onClick:W,className:"h-9 px-3 text-xs",children:r("pageEditor.odd")||"Odd"}),e.jsx(m,{variant:"ghost",size:"sm",onClick:X,className:"h-9 px-3 text-xs",children:r("pageEditor.even")||"Even"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[g.size>0&&e.jsxs(ne,{variant:"secondary",className:"bg-ocean-100 text-ocean-700 dark:bg-ocean-900/30 dark:text-ocean-300 font-medium",children:[g.size," ",r("common.pages")," ",r("common.selected")||"selected"]}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>x(new Set),disabled:g.size===0,className:"text-gray-500 hover:text-red-500",children:r("common.reset")})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:K?Array.from({length:w}).map((s,a)=>e.jsx(M,{className:"aspect-[1/1.4] animate-pulse bg-gray-100 dark:bg-gray-800 border-none"},a)):H.map(s=>{const a=g.has(s.pageNumber);return e.jsxs(M,{className:`
                    relative group overflow-hidden cursor-pointer transition-all duration-200 border-2
                    ${a?"border-red-500 shadow-md ring-1 ring-red-500/20":"border-transparent hover:border-gray-200 dark:hover:border-gray-700"}
                  `,onClick:()=>L(s.pageNumber),children:[e.jsx("div",{className:"absolute top-2 left-2 z-10",children:e.jsx(pe,{checked:a,onCheckedChange:()=>L(s.pageNumber),className:`
                        w-5 h-5 bg-white/90 backdrop-blur-sm data-[state=checked]:bg-red-500 data-[state=checked]:border-red-500
                        ${a?"opacity-100":"opacity-0 group-hover:opacity-100"}
                        transition-opacity duration-200
                      `})}),e.jsx("div",{className:"absolute top-2 right-2 z-10 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx(m,{size:"icon",variant:"secondary",className:"h-7 w-7 bg-white/90 dark:bg-black/50 backdrop-blur-sm",onClick:t=>{t.stopPropagation(),A(s.pageNumber)},children:e.jsx(fe,{className:"h-4 w-4"})})}),e.jsx("div",{className:"p-1 aspect-[1/1.4] flex items-center justify-center bg-gray-50 dark:bg-gray-900 group-hover:scale-[1.02] transition-transform duration-300",children:e.jsx("img",{src:s.dataUrl,alt:`Page ${s.pageNumber}`,className:"max-w-full max-h-full object-contain shadow-sm"})}),e.jsxs("div",{className:"py-1 text-center text-[10px] font-bold text-gray-400 bg-white dark:bg-gray-800 border-t border-gray-100 dark:border-gray-700 uppercase tracking-wider",children:[r("common.page")," ",s.pageNumber]}),a&&e.jsx("div",{className:"absolute inset-0 bg-red-500/5 mix-blend-multiply pointer-events-none"})]},s.pageNumber)})}),h&&e.jsx("div",{className:"mt-8",children:e.jsx(ge,{progress:U,message:O})}),N!==null&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh] bg-white dark:bg-gray-900 rounded-2xl overflow-hidden shadow-2xl flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 dark:border-gray-800 flex items-center justify-between",children:[e.jsxs("span",{className:"font-bold text-lg",children:[r("common.page")," ",N]}),e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>A(null),children:e.jsx(oe,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4 flex items-center justify-center min-h-0",children:q?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(B,{className:"h-8 w-8 animate-spin text-ocean-500"}),e.jsx("span",{className:"text-sm text-gray-500",children:r("common.loading")})]}):E?e.jsx("img",{src:E,alt:"Zoomed page",className:"max-w-full h-auto shadow-lg rounded-lg"}):null})]})})]}):null,se=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-red-500"}),r("deletePages.selectPages")]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-xl p-4",children:[e.jsx(ie,{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 block",children:r("deletePages.pagesToDelete")}),e.jsx(de,{type:"text",value:S,onChange:s=>b(s.target.value),placeholder:"e.g. 1, 3, 5-7",disabled:h,className:"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:r("deletePages.hint",{total:String(w)})})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl p-4 flex gap-3",children:[e.jsx(ce,{className:"w-5 h-5 text-amber-600 dark:text-amber-500 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-semibold text-amber-800 dark:text-amber-400 mb-1",children:r("deletePages.warning")}),e.jsx("p",{className:"text-amber-700 dark:text-amber-300 text-xs",children:r("deletePages.warningDescription")})]})]})]})]}),ae=()=>{const s=_(S,w).length;return e.jsx(m,{onClick:G,disabled:h||!l||s===0,className:"w-full py-6 text-lg rounded-xl font-bold shadow-lg hover:shadow-xl transition-all !bg-red-600 hover:!bg-red-700 text-white",children:h?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 animate-spin"}),r("common.processing")]}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),r("deletePages.deleteButton"),s>0&&` (${s})`]})})};return e.jsx(me,{title:r("tools.delete-pages-pdf.name"),description:r("tools.delete-pages-pdf.description"),hasFiles:!!l,onUpload:Q,isProcessing:h,maxFiles:1,uploadTitle:r("common.selectFile"),uploadDescription:r("upload.singleFileAllowed"),settings:!d&&l?se():null,actions:!d&&l?ae():null,children:ee()})};export{Ee as DeletePagesPDF};
