import{u as te,b as re,r as o,p as N,j as e,a as c,Q as M,N as B,t as y,K as ne,M as le,S as oe,c as ce,W as ie,B as de,X as me,L as ge,k as pe,H as xe}from"./index-ByNlfbxM.js";import{T as he,C as O}from"./ToolLayout-CEHQ6Lwh.js";import{P as ue}from"./ProgressBar-CKe5kCn5.js";import{u as fe}from"./usePDFThumbnails-eY65WYZv.js";import{C as be}from"./checkbox-D18Jwqrr.js";import{S as je}from"./square-check-big-BqIIb0Re.js";import{S as Ne}from"./square-_W1DGeXi.js";import{Z as ye}from"./zoom-in-ByqnYBDA.js";import"./vendor-react-CTjRfaZN.js";import"./vendor-pdfjs-BlOy0ZkI.js";import"./vendor-pdf-lib-CZHCEpXA.js";import"./vendor-word-CeUssL8V.js";import"./vendor-ocr-CTFn7PEu.js";import"./FileUpload-vqoJmZZ0.js";import"./index-NZhszMUr.js";const Ze=()=>{const{t:r}=te(),{sharedFile:u,clearSharedFile:z,setSharedFile:k}=re(),[n,x]=o.useState(null),[h,I]=o.useState(!1),[R,S]=o.useState(0),[H,E]=o.useState(""),[i,w]=o.useState(null),[A,P]=o.useState(!1),[m,p]=o.useState(new Set),[C,f]=o.useState(""),[b,D]=o.useState(null),[_,L]=o.useState(null),[U,T]=o.useState(!1),{thumbnails:q,isLoading:Q}=fe({file:n?.file,thumbnailWidth:200,thumbnailHeight:280});o.useEffect(()=>{if(u&&!n&&!i){const s=new File([u.blob],u.name,{type:"application/pdf"}),a={id:`${Date.now()}`,file:s,name:u.name,size:s.size,status:"pending"};x(a),N.getPDFInfo(s).then(t=>{x(l=>l?{...l,info:t,status:"completed"}:null)}).catch(()=>{x(t=>t?{...t,status:"error",error:"Failed to read PDF"}:null)}),z()}},[u,n,i,z]),o.useEffect(()=>{if(i&&!h&&!A){const s=n?.name.replace(/\.pdf$/i,"_extracted_pages.pdf")||"extracted_pages.pdf";k(i,s,"extract-pages-pdf"),P(!0)}},[i,h,A,n?.name,k]),o.useEffect(()=>{const s=Array.from(m).sort((a,t)=>a-t);s.length>0?f(s.join(", ")):f("")},[m]),o.useEffect(()=>{(async()=>{if(b!==null&&n?.file){T(!0),L(null);try{const a=await N.renderPageAsImage(n.file,b,2.5);L(a)}catch(a){console.error("Failed to load zoomed image",a),y.error(r("common.error"))}finally{T(!1)}}})()},[b,n,r]);const W=async s=>{const a=s[0];if(!a)return;const t={id:`${Date.now()}`,file:a,name:a.name,size:a.size,status:"pending"};x(t),w(null),p(new Set),f("");try{const l=await N.getPDFInfo(a);x(d=>d?{...d,info:l,status:"completed"}:null)}catch{x(l=>l?{...l,status:"error",error:"Failed to read PDF"}:null)}},Z=s=>{p(a=>{const t=new Set(a);return t.has(s)?t.delete(s):t.add(s),t})},K=()=>{const s=n?.info?.pages||0;m.size===s?p(new Set):p(new Set(Array.from({length:s},(a,t)=>t+1)))},X=()=>{const s=n?.info?.pages||0,a=Array.from({length:s},(t,l)=>l+1).filter(t=>t%2!==0);p(new Set(a))},G=()=>{const s=n?.info?.pages||0,a=Array.from({length:s},(t,l)=>l+1).filter(t=>t%2===0);p(new Set(a))},J=(s,a)=>{const t=new Set,l=s.split(/[, ]+/).map(d=>d.trim());for(const d of l)if(d.includes("-")){const[g,$]=d.split("-").map(j=>parseInt(j.trim()));if(!isNaN(g)&&!isNaN($))for(let j=Math.max(1,g);j<=Math.min(a,$);j++)t.add(j)}else{const g=parseInt(d);!isNaN(g)&&g>=1&&g<=a&&t.add(g)}return Array.from(t).sort((d,g)=>d-g)},V=async()=>{if(!n)return;const s=n.info?.pages||0,a=J(C,s);if(a.length===0){y.error(r("extractPages.invalidPages"));return}I(!0),S(0),w(null),P(!1);try{const t=await N.extractPDF(n.file,a,(l,d)=>{S(l),E(d)});t.success&&t.data?(w(t.data),y.success(r("extractPages.success"))):y.error(r("extractPages.failed"))}catch(t){y.error(r("extractPages.failed")),console.error(t)}finally{I(!1)}},Y=()=>{if(!i||!n)return;const s=n.name.replace(/\.pdf$/i,"_extracted.pdf");N.downloadFile(i,s)},ee=()=>{x(null),w(null),P(!1),f(""),p(new Set),S(0),E("")},v=async s=>{if(!i||!n)return;const a=n.name.replace(/\.pdf$/i,"_extracted.pdf");k(i,a,"extract-pages-pdf"),await new Promise(t=>setTimeout(t,100)),window.location.hash=xe[s]},F=n?.info?.pages||1,se=()=>n?i?e.jsxs("div",{className:"text-center space-y-6 animate-in fade-in slide-in-from-bottom-4 pt-4",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto text-green-600",children:e.jsx(ne,{className:"w-10 h-10"})}),e.jsx("h2",{className:"text-2xl font-bold",children:r("extractPages.success")}),e.jsx("p",{className:"text-gray-500",children:r("extractPages.successDescription")}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(c,{onClick:Y,size:"lg",className:"bg-green-600 hover:bg-green-700 shadow-lg hover:shadow-xl transition-all",children:r("common.download")}),e.jsx(c,{onClick:ee,variant:"outline",size:"lg",children:r("extractPages.extractAnother")})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mt-8 max-w-2xl mx-auto",children:[e.jsxs(c,{onClick:()=>v("compress-pdf"),variant:"outline",className:"h-auto py-4 flex flex-col gap-2",children:[e.jsx(le,{className:"h-5 w-5"}),e.jsx("span",{children:r("tools.compress-pdf.name")})]}),e.jsxs(c,{onClick:()=>v("protect-pdf"),variant:"outline",className:"h-auto py-4 flex flex-col gap-2",children:[e.jsx(oe,{className:"h-5 w-5"}),e.jsx("span",{children:r("tools.protect-pdf.name")})]}),e.jsxs(c,{onClick:()=>v("watermark-pdf"),variant:"outline",className:"h-auto py-4 flex flex-col gap-2",children:[e.jsx(ce,{className:"h-5 w-5"}),e.jsx("span",{children:r("tools.watermark-pdf.name")})]}),e.jsxs(c,{onClick:()=>v("merge-pdf"),variant:"outline",className:"h-auto py-4 flex flex-col gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),e.jsx("span",{children:r("tools.merge-pdf.name")})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 bg-white dark:bg-gray-800 p-3 rounded-xl border border-gray-100 dark:border-gray-700 sticky top-0 z-20 shadow-sm backdrop-blur-md bg-white/80 dark:bg-gray-800/80",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(c,{variant:"ghost",size:"sm",onClick:K,className:"h-9 gap-2",children:[m.size===F?e.jsx(je,{className:"w-4 h-4 text-ocean-500"}):e.jsx(Ne,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:r("common.selectAll")})]}),e.jsx("div",{className:"h-4 w-px bg-gray-200 dark:bg-gray-700 hidden sm:block"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:X,className:"h-9 px-3 text-xs",children:r("pageEditor.odd")||"Odd"}),e.jsx(c,{variant:"ghost",size:"sm",onClick:G,className:"h-9 px-3 text-xs",children:r("pageEditor.even")||"Even"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[m.size>0&&e.jsxs(de,{variant:"secondary",className:"bg-ocean-100 text-ocean-700 dark:bg-ocean-900/30 dark:text-ocean-300 font-medium",children:[m.size," ",r("common.pages")," ",r("common.selected")||"selected"]}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>p(new Set),disabled:m.size===0,className:"text-gray-500 hover:text-red-500",children:r("common.reset")})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:Q?Array.from({length:F}).map((s,a)=>e.jsx(O,{className:"aspect-[1/1.4] animate-pulse bg-gray-100 dark:bg-gray-800 border-none"},a)):q.map(s=>{const a=m.has(s.pageNumber);return e.jsxs(O,{className:`
                    relative group overflow-hidden cursor-pointer transition-all duration-200 border-2
                    ${a?"border-ocean-500 shadow-md ring-1 ring-ocean-500/20":"border-transparent hover:border-gray-200 dark:hover:border-gray-700"}
                  `,onClick:()=>Z(s.pageNumber),children:[e.jsx("div",{className:"absolute top-2 left-2 z-10",children:e.jsx(be,{checked:a,onCheckedChange:()=>Z(s.pageNumber),className:`
                        w-5 h-5 bg-white/90 backdrop-blur-sm data-[state=checked]:bg-ocean-500 data-[state=checked]:border-ocean-500
                        ${a?"opacity-100":"opacity-0 group-hover:opacity-100"}
                        transition-opacity duration-200
                      `})}),e.jsx("div",{className:"absolute top-2 right-2 z-10 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx(c,{size:"icon",variant:"secondary",className:"h-7 w-7 bg-white/90 dark:bg-black/50 backdrop-blur-sm",onClick:t=>{t.stopPropagation(),D(s.pageNumber)},children:e.jsx(ye,{className:"h-4 w-4"})})}),e.jsx("div",{className:"p-1 aspect-[1/1.4] flex items-center justify-center bg-gray-50 dark:bg-gray-900 group-hover:scale-[1.02] transition-transform duration-300",children:e.jsx("img",{src:s.dataUrl,alt:`Page ${s.pageNumber}`,className:"max-w-full max-h-full object-contain shadow-sm"})}),e.jsxs("div",{className:"py-1 text-center text-[10px] font-bold text-gray-400 bg-white dark:bg-gray-800 border-t border-gray-100 dark:border-gray-700 uppercase tracking-wider",children:[r("common.page")," ",s.pageNumber]}),a&&e.jsx("div",{className:"absolute inset-0 bg-ocean-500/5 mix-blend-multiply pointer-events-none"})]},s.pageNumber)})}),h&&e.jsx("div",{className:"mt-8",children:e.jsx(ue,{progress:R,message:H})}),b!==null&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh] bg-white dark:bg-gray-900 rounded-2xl overflow-hidden shadow-2xl flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 dark:border-gray-800 flex items-center justify-between",children:[e.jsxs("span",{className:"font-bold text-lg",children:[r("common.page")," ",b]}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>D(null),children:e.jsx(me,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4 flex items-center justify-center min-h-0",children:U?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(M,{className:"h-8 w-8 animate-spin text-ocean-500"}),e.jsx("span",{className:"text-sm text-gray-500",children:r("common.loading")})]}):_?e.jsx("img",{src:_,alt:"Zoomed page",className:"max-w-full h-auto shadow-lg rounded-lg"}):null})]})})]}):null,ae=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ge,{className:"text-sm font-medium",children:r("extractPages.pagesToExtract")}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-xl p-4",children:[e.jsx(pe,{value:C,onChange:s=>f(s.target.value),placeholder:"e.g. 1, 3, 5-7",className:"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:r("extractPages.hint",{total:String(F)})})]})]}),e.jsxs("div",{className:"bg-ocean-50 dark:bg-ocean-900/20 p-4 rounded-xl text-sm text-ocean-700 dark:text-ocean-300 border border-ocean-100 dark:border-ocean-900/50",children:[e.jsxs("p",{className:"font-semibold mb-1 flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4"}),r("extractPages.info")]}),e.jsx("p",{className:"opacity-80",children:r("extractPages.infoDescription")})]})]});return e.jsx(he,{title:r("tools.extract-pages-pdf.name"),description:r("tools.extract-pages-pdf.description"),hasFiles:!!n,onUpload:W,isProcessing:h,maxFiles:1,uploadTitle:r("common.selectFile"),uploadDescription:r("upload.singleFileAllowed"),acceptedTypes:".pdf",settings:!i&&n?ae():null,actions:!i&&n?e.jsx(c,{onClick:V,disabled:h||!C,className:"w-full py-6 text-lg font-bold shadow-lg hover:shadow-xl transition-all",children:h?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 animate-spin"}),r("common.processing")]}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),r("extractPages.extractButton"),m.size>0&&` (${m.size})`]})}):null,children:se()})};export{Ze as ExtractPagesPDF};
