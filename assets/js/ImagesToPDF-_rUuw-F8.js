import{u as se,r as m,j as e,B as I,a as h,b as Ne,K as ke,U as Z,O as Ie,L as q,p as _}from"./index-BaqsOxPK.js";import{C as J,a as K,T as Se}from"./ToolLayout-pcKgwv4w.js";import{s as ee}from"./smartImageFilterService-TF3bgHdk.js";import{E as Fe}from"./eye-C3xZTV_n.js";import"./vendor-react-CTjRfaZN.js";import"./vendor-pdfjs-BlOy0ZkI.js";import"./vendor-pdf-lib-CZHCEpXA.js";import"./vendor-word-CeUssL8V.js";import"./vendor-ocr-CTFn7PEu.js";import"./FileUpload-DUSj1Bnl.js";const Ce=({analysisResult:l,isAnalyzing:y,enabled:u,onToggle:T,onApplyFilter:A,onSelectCategory:d,selectedCategories:x})=>{const{t:o}=se(),[p,S]=m.useState("categories"),k=()=>e.jsx("button",{onClick:()=>T(!u),className:`relative inline-flex h-5 w-9 items-center rounded-full transition-colors ${u?"bg-ocean-500":"bg-gray-300 dark:bg-gray-600"}`,"aria-label":u?"Disable Smart Image Filter":"Enable Smart Image Filter",children:e.jsx("span",{className:`inline-block h-3.5 w-3.5 transform rounded-full bg-white transition-transform ${u?"translate-x-5":"translate-x-1"}`})});if(!u)return e.jsx(J,{className:"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:e.jsx(K,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 opacity-60",children:[e.jsx("span",{className:"text-base",children:"ðŸŽ¨"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:o("smartImageFilter.title")||"Smart Image Filter"}),e.jsx(I,{variant:"secondary",className:"text-[10px] bg-gray-400 text-white",children:"AI"})]}),e.jsx(k,{})]})})});if(y)return e.jsx(J,{className:"border-ocean-400/50 dark:border-ocean-500/30 bg-white dark:bg-gray-800/90",children:e.jsx(K,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-ocean-500 border-t-transparent rounded-full"}),e.jsx("span",{className:"text-sm text-ocean-700 dark:text-ocean-300",children:o("smartImageFilter.analyzing")||"Analyzing images..."})]}),e.jsx(k,{})]})})});if(!l)return null;const{categories:f,usefulImages:P,likelyJunk:v,totalImages:F}=l,M=[{id:"useful",label:o("smartImageFilter.presets.useful.label")||"Useful Images",icon:"â­",description:o("smartImageFilter.presets.useful.description")||"Photos and charts only",count:P.length},{id:"photos-only",label:o("smartImageFilter.presets.photosOnly.label")||"Photos Only",icon:"ðŸ“·",description:o("smartImageFilter.presets.photosOnly.description")||"High-quality photos",count:f.find(n=>n.category==="photo")?.count||0},{id:"exclude-icons",label:o("smartImageFilter.presets.excludeIcons.label")||"No Icons",icon:"ðŸš«",description:o("smartImageFilter.presets.excludeIcons.description")||"Exclude small icons",count:F-(f.find(n=>n.category==="icon")?.count||0)-(f.find(n=>n.category==="decoration")?.count||0)},{id:"large",label:o("smartImageFilter.presets.large.label")||"Large Images",icon:"ðŸ–¼ï¸",description:o("smartImageFilter.presets.large.description")||"Images > 0.1 MP",count:f.reduce((n,w)=>n+w.images.filter(L=>L.megapixels>=.1).length,0)}];return e.jsx(J,{className:"border-ocean-400/50 dark:border-ocean-500/30 bg-gradient-to-br from-ocean-50/50 to-privacy-50/30 dark:from-ocean-900/20 dark:to-privacy-900/10",children:e.jsxs(K,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸŽ¨"}),e.jsx("h3",{className:"text-base font-semibold text-ocean-900 dark:text-ocean-100",children:o("smartImageFilter.title")||"Smart Image Filter"}),e.jsx(I,{variant:"secondary",className:"text-[10px] bg-ocean-500 text-white",children:"AI"})]}),e.jsx(k,{})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[o("smartImageFilter.totalImages")||"Total",":"]}),e.jsx("span",{className:"font-semibold text-ocean-700 dark:text-ocean-300",children:F})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["â­ ",o("smartImageFilter.useful")||"Useful",":"]}),e.jsx("span",{className:"font-semibold text-green-700 dark:text-green-300",children:P.length})]}),v.length>0&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"text-amber-600 dark:text-amber-400",children:["ðŸ—‘ï¸ ",o("smartImageFilter.junk")||"Junk",":"]}),e.jsx("span",{className:"font-semibold text-amber-700 dark:text-amber-300",children:v.length})]})]}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>S(p==="presets"?null:"presets"),className:"flex items-center justify-between w-full text-sm font-medium text-ocean-800 dark:text-ocean-200 mb-2 hover:text-ocean-600 dark:hover:text-ocean-300 transition-colors",children:[e.jsx("span",{children:o("smartImageFilter.quickFilters")||"Quick Filters"}),e.jsx("svg",{className:`w-4 h-4 transition-transform ${p==="presets"?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),p==="presets"&&e.jsx("div",{className:"grid grid-cols-2 gap-2",children:M.map(n=>e.jsx(h,{onClick:()=>A(n.id),variant:"outline",className:"h-auto p-3 border-2 hover:border-ocean-500 hover:bg-ocean-50 dark:hover:bg-ocean-900/20 group justify-start",disabled:n.count===0,children:e.jsxs("div",{className:"text-left",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-base",children:n.icon}),e.jsx("span",{className:"font-medium text-xs text-gray-900 dark:text-white group-hover:text-ocean-600 dark:group-hover:text-ocean-400",children:n.label}),e.jsx(I,{variant:"secondary",className:"text-[10px]",children:n.count})]}),e.jsx("p",{className:"text-[10px] text-gray-500 dark:text-gray-400",children:n.description})]})},n.id))})]}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>S(p==="categories"?null:"categories"),className:"flex items-center justify-between w-full text-sm font-medium text-ocean-800 dark:text-ocean-200 mb-2 hover:text-ocean-600 dark:hover:text-ocean-300 transition-colors",children:[e.jsx("span",{children:o("smartImageFilter.categories")||"Categories"}),e.jsx("svg",{className:`w-4 h-4 transition-transform ${p==="categories"?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),p==="categories"&&e.jsx("div",{className:"space-y-2",children:f.map(n=>{const w=x.has(n.category);return e.jsxs("button",{onClick:()=>d(n.category,!w),className:`w-full flex items-center justify-between p-2.5 rounded-lg border-2 transition-all ${w?"border-ocean-500 bg-ocean-50 dark:bg-ocean-900/30":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:()=>{},className:"w-4 h-4 text-ocean-600 border-gray-300 rounded focus:ring-ocean-500"}),e.jsx("span",{className:"text-base",children:n.icon}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:n.label})]}),e.jsx(I,{variant:w?"default":"secondary",className:"text-xs",children:n.count})]},n.category)})})]}),v.length>0&&e.jsx("div",{className:"bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-base",children:"ðŸ’¡"}),e.jsxs("div",{className:"text-xs",children:[e.jsx("p",{className:"font-medium text-amber-900 dark:text-amber-100 mb-1",children:o("smartImageFilter.junkWarning.title")||"Low-value images detected"}),e.jsx("p",{className:"text-amber-700 dark:text-amber-300",children:o("smartImageFilter.junkWarning.description")||`Found ${v.length} small icons/decorations. Consider using "Useful Images" filter.`})]})]})}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 pt-2 border-t border-gray-200 dark:border-gray-700",children:o("smartImageFilter.processingInfo")||"All analysis runs locally in your browser. Images are categorized by size, format, and characteristics."})]})})},Be=()=>{const{t:l}=se(),{sharedFile:y,sharedFiles:u,clearSharedFile:T,clearSharedFiles:A}=Ne(),[d,x]=m.useState([]),[o,p]=m.useState("fit"),[S,k]=m.useState("portrait"),[f,P]=m.useState(0),[v,F]=m.useState(!1),[M,n]=m.useState(0),[w,L]=m.useState(""),[N,E]=m.useState(null),[C,R]=m.useState(null),[U,te]=m.useState(!0),[ae,G]=m.useState(!1),[z,O]=m.useState(null),[B,re]=m.useState(new Set(["photo","chart","logo","other"])),[Q,ne]=m.useState(new Map),V=s=>{if(s.type.startsWith("image/"))return!0;const a=s.name.toLowerCase().split(".").pop();return["jpg","jpeg","png","gif","webp","bmp","tiff"].includes(a||"")};m.useEffect(()=>{if(d.length===0||!U){O(null);return}const a=setTimeout(async()=>{G(!0);try{const t=await Promise.all(d.map(async(i,j)=>{if(!i.width||!i.height){const D=await $(i.file);i.width=D.width,i.height=D.height}return{id:i.id,blob:i.file,filename:i.name,width:i.width||0,height:i.height||0,pageNumber:j+1,format:i.file.type.includes("png")?"png":"jpg",extension:i.name.split(".").pop()||"",mimeType:i.file.type,size:i.size,previewUrl:i.preview}})),r=ee.analyzeImages(t);O(r);const b=await Promise.all(d.map(async i=>{const j=await i.file.arrayBuffer(),D=await crypto.subtle.digest("SHA-256",j),ve=Array.from(new Uint8Array(D)).map(we=>we.toString(16).padStart(2,"0")).join("");return{id:i.id,hash:ve}})),c=new Map;b.forEach(({id:i,hash:j})=>{c.has(j)||c.set(j,[]),c.get(j).push(i)});const g=new Map;c.forEach((i,j)=>{i.length>1&&g.set(j,i)}),ne(g)}catch(t){console.error("Image analysis failed:",t)}finally{G(!1)}},500);return()=>clearTimeout(a)},[d,U]);const $=m.useCallback(s=>new Promise(a=>{const t=new Image;t.onload=()=>a({width:t.width,height:t.height}),t.onerror=()=>a({width:0,height:0}),t.src=URL.createObjectURL(s)}),[]),W=m.useCallback(async s=>{const a=[];for(let t=0;t<s.length;t++){const r=s[t];if(!r.type.startsWith("image/"))continue;const b=URL.createObjectURL(r),c=await $(r);a.push({id:`${Date.now()}-${t}`,file:r,name:r.name,size:r.size,preview:b,width:c.width,height:c.height})}x(t=>[...t,...a]),E(null)},[$]);m.useEffect(()=>{if(d.length>0)return;const s=[];if(u?.files?.length)u.files.forEach(a=>{const t=new File([a.blob],a.name,{type:a.blob.type});V(t)&&s.push(t)});else if(y){const a=new File([y.blob],y.name,{type:y.blob.type});V(a)&&s.push(a)}s.length>0&&W(s),y&&T(),u&&A()},[y,u,d.length,T,A,W]);const ie=s=>{x(a=>{const t=a.find(r=>r.id===s);return t&&URL.revokeObjectURL(t.preview),a.filter(r=>r.id!==s)})},le=s=>{if(!z)return;const t=ee.getFilterPresets().find(g=>g.id===s);if(!t)return;const b=z.categories.flatMap(g=>g.images).filter(t.filter),c=new Set(b.map(g=>g.id));x(g=>g.map(i=>({...i,hidden:!c.has(i.id)})))},oe=(s,a)=>{if(re(t=>{const r=new Set(t);return a?r.add(s):r.delete(s),r}),z){const t=a?new Set([...B,s]):new Set([...B].filter(c=>c!==s));if(t.size===0){x(c=>c.map(g=>({...g,hidden:!1})));return}const r=z.categories.filter(c=>t.has(c.category)).flatMap(c=>c.images),b=new Set(r.map(c=>c.id));x(c=>c.map(g=>({...g,hidden:!b.has(g.id)})))}},ce=()=>{const s=new Set;Q.forEach(a=>a.slice(1).forEach(t=>s.add(t))),x(a=>(a.forEach(t=>{s.has(t.id)&&URL.revokeObjectURL(t.preview)}),a.filter(t=>!s.has(t.id))))},de=()=>{const s=d.filter(t=>(t.width||0)>(t.height||0)).length,a=d.length-s;k(s>a?"landscape":"portrait")},me=s=>R(s),ge=(s,a)=>{if(s.preventDefault(),C===null||C===a)return;const t=[...d],r=t[C];t.splice(C,1),t.splice(a,0,r),x(t),R(a)},he=()=>R(null),xe=async()=>{const s=d.filter(a=>!a.hidden);if(s.length===0){alert(l("imagesToPdf.errors.noImages"));return}F(!0),n(0),E(null);try{const a=s.map(r=>r.file),t=await _.imagesToPDF(a,(r,b)=>{n(r),L(b)},{pageSize:o,orientation:S,margin:f});t.success&&t.data?E({blob:t.data,metadata:t.metadata}):alert(t.error?.message||"Conversion failed")}catch(a){console.error(a),alert("An error occurred during conversion")}finally{F(!1)}},ue=()=>{N?.blob&&_.downloadFile(N.blob,"images-to-pdf.pdf")},X=()=>{d.forEach(s=>URL.revokeObjectURL(s.preview)),x([]),E(null),n(0),L(""),O(null)},pe=s=>{if(s===0)return"0 B";const a=1024,t=["B","KB","MB","GB"],r=Math.floor(Math.log(s)/Math.log(a));return`${(s/Math.pow(a,r)).toFixed(1)} ${t[r]}`},Y=Array.from(Q.values()).reduce((s,a)=>s+a.length-1,0),fe=d.filter(s=>!s.hidden).length,H=d.filter(s=>s.hidden).length,be=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ce,{analysisResult:z,isAnalyzing:ae,enabled:U,onToggle:te,onApplyFilter:le,onSelectCategory:oe,selectedCategories:B}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{children:l("imagesToPdf.pageSize")}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 mt-2",children:[e.jsx(h,{onClick:()=>p("fit"),variant:o==="fit"?"default":"outline",size:"sm",className:"w-full h-auto py-2 whitespace-normal text-center min-h-[2.25rem]",children:l("imagesToPdf.pageSizes.fit")}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["a4","letter"].map(s=>e.jsx(h,{onClick:()=>p(s),variant:o===s?"default":"outline",size:"sm",className:"w-full",children:l(`imagesToPdf.pageSizes.${s}`)},s))})]})]}),e.jsxs("div",{children:[e.jsx(q,{children:l("imagesToPdf.orientation")}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:["portrait","landscape"].map(s=>e.jsx(h,{onClick:()=>k(s),variant:S===s?"default":"outline",size:"sm",className:"w-full",children:l(`imagesToPdf.orientations.${s}`)},s))})]}),e.jsxs("div",{children:[e.jsxs(q,{children:[l("imagesToPdf.margin"),": ",f,"px"]}),e.jsx("input",{type:"range",min:"0",max:"50",step:"5",value:f,onChange:s=>P(Number(s.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700 mt-2"})]})]})]}),je=()=>d.length?N?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-2 border-green-200 dark:border-green-800 rounded-2xl p-8",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 dark:bg-green-900/50 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ke,{className:"w-10 h-10 text-green-600 dark:text-green-400"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:l("common.success")}),e.jsxs("div",{className:"text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsx("p",{children:l("imagesToPdf.successMessage",{count:N.metadata?.pageCount||d.length})}),e.jsxs("p",{className:"text-sm",children:[l("common.fileSize"),": ",pe(N.metadata?.processedSize||0)]})]})]})}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(h,{onClick:ue,size:"lg",className:"bg-green-600 hover:bg-green-700 text-white shadow-lg hover:shadow-xl transition-all",children:l("common.download")}),e.jsx(h,{variant:"outline",onClick:X,size:"lg",children:l("common.convertAnother")})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-ocean-900 dark:text-white",children:[l("imagesToPdf.imagesList")," (",fe,")"]}),H>0&&e.jsxs(I,{variant:"secondary",children:[H," hidden"]})]}),e.jsxs("div",{className:"flex gap-2",children:[H>0&&e.jsxs(h,{onClick:()=>x(s=>s.map(a=>({...a,hidden:!1}))),variant:"outline",size:"sm",children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"})," Show All"]}),Y>0&&e.jsxs(h,{onClick:ce,variant:"outline",size:"sm",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"})," ",l("smartOrganize.removeDuplicates")," (",Y,")"]}),e.jsxs(h,{onClick:de,variant:"outline",size:"sm",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"})," Auto Orientation"]}),e.jsx(h,{onClick:X,variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-600 hover:bg-red-50",children:l("common.clearAll")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:[d.filter(s=>!s.hidden).map((s,a)=>e.jsxs("div",{draggable:!0,onDragStart:()=>me(a),onDragOver:t=>ge(t,a),onDragEnd:he,className:`relative group cursor-move border-2 rounded-lg overflow-hidden transition-all bg-white dark:bg-gray-800 ${C===a?"border-ocean-500 shadow-lg scale-105":"border-gray-200 dark:border-gray-700"}`,children:[e.jsx("div",{className:"aspect-[3/4] overflow-hidden bg-gray-100 dark:bg-gray-900",children:e.jsx("img",{src:s.preview,alt:s.name,className:"w-full h-full object-contain"})}),e.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(h,{onClick:()=>ie(s.id),variant:"destructive",size:"icon",className:"h-8 w-8 rounded-full shadow-md",children:e.jsx(Z,{className:"w-4 h-4"})})}),e.jsxs("div",{className:"p-2 text-xs truncate border-t dark:border-gray-700",children:[a+1,". ",s.name]}),s.width&&s.height&&e.jsxs(I,{variant:"secondary",className:"absolute top-2 left-2 text-[10px] opacity-75",children:[s.width,"Ã—",s.height]})]},s.id)),e.jsxs("div",{className:"aspect-[3/4] border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-lg flex flex-col items-center justify-center text-gray-400 hover:text-gray-500 hover:border-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition-all",onClick:()=>document.getElementById("tool-layout-upload-input")?.click(),children:[e.jsx("span",{className:"text-4xl mb-2",children:"+"}),e.jsx("span",{className:"text-sm",children:"Add More"})]})]})]}):null,ye=()=>e.jsx(h,{onClick:xe,disabled:v||!d.length,className:"w-full py-6 text-lg rounded-xl font-bold shadow-lg hover:shadow-xl transition-all",children:l(v?"common.processing":"imagesToPdf.convert")});return e.jsx(Se,{title:l("tools.images-to-pdf.name"),description:l("tools.images-to-pdf.description"),hasFiles:d.length>0,onUpload:W,isProcessing:v,progress:M,progressMessage:w,maxFiles:50,uploadTitle:l("common.selectFile"),uploadDescription:l("upload.multipleFilesAllowed"),acceptedTypes:"image/jpeg,image/jpg,image/png",settings:N?null:be(),actions:N?null:ye(),children:je()})};export{Be as ImagesToPDF};
