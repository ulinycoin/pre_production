import{u as N,J as z,b as k,r as c,j as e,K as v,p as n,a as g,W as D}from"./index-BaqsOxPK.js";import{T as C}from"./ToolLayout-pcKgwv4w.js";import{D as B}from"./DownloadGate-DG4D_ywK.js";import{R as A}from"./refresh-cw-CE5DMPth.js";import"./vendor-react-CTjRfaZN.js";import"./vendor-pdfjs-BlOy0ZkI.js";import"./vendor-pdf-lib-CZHCEpXA.js";import"./vendor-word-CeUssL8V.js";import"./vendor-ocr-CTFn7PEu.js";import"./FileUpload-DUSj1Bnl.js";import"./download-0nOk4Jfy.js";const _=()=>{const{t:a}=N(),{isPremium:f}=z(),{sharedFile:r,clearSharedFile:p}=k(),[s,u]=c.useState(null),[d,x]=c.useState(!1),[l,o]=c.useState(null);c.useEffect(()=>{if(r&&!s){const t=new File([r.blob],r.name,{type:"application/pdf"});h([t]),p()}},[r,s,p]);const h=t=>{t.length>0&&(u({id:Date.now().toString(),file:t[0],name:t[0].name,size:t[0].size,status:"completed"}),o(null))},y=async()=>{if(s){x(!0),o(null);try{const t=await n.flattenPDF(s.file,()=>{});t.success&&t.data?o({blob:t.data,metadata:t.metadata||{}}):alert(t.error?.message||"Flattening failed")}catch{alert("Flattening failed")}finally{x(!1)}}},b=async t=>{if(!l)return;let i=l.blob;if(!f&&t)try{const m=await l.blob.arrayBuffer(),S=await n.applyWatermark(new Uint8Array(m));i=new Blob([new Uint8Array(S)],{type:"application/pdf"})}catch(m){console.error("Failed to apply watermark:",m)}n.downloadFile(i,s?.name.replace(".pdf","_flattened.pdf")||"flattened.pdf")},j=()=>{u(null),o(null)},w=()=>{if(!s)return null;if(l){const t=typeof l.metadata.originalSize=="number"?l.metadata.originalSize:0,i=typeof l.metadata.processedSize=="number"?l.metadata.processedSize:0;return e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto text-green-600",children:e.jsx(v,{className:"w-10 h-10"})}),e.jsx("h2",{className:"text-2xl font-bold",children:a("flatten.success.title")}),e.jsxs("div",{className:"text-gray-500 space-y-1",children:[e.jsxs("p",{children:[a("flatten.success.originalSize"),": ",n.formatFileSize(t)]}),e.jsxs("p",{children:[a("flatten.success.processedSize"),": ",n.formatFileSize(i)]})]}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(B,{toolId:"flatten-pdf",onDownload:b,showWatermarkLabel:!f}),e.jsxs(g,{onClick:j,variant:"outline",className:"h-11 px-8 rounded-xl font-bold border-2",children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),a("flatten.flattenAnother")]})]})]})}return e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx("div",{className:"w-24 h-24 bg-orange-100 dark:bg-orange-900/30 rounded-2xl flex items-center justify-center text-orange-600",children:e.jsx(D,{className:"w-12 h-12"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-xl font-bold",children:s.name}),e.jsx("p",{className:"text-gray-500",children:n.formatFileSize(s.size)})]}),e.jsx("div",{className:"text-sm text-gray-500 max-w-md text-center bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:a("flatten.description")})]})},F=()=>e.jsx(g,{onClick:y,disabled:d,className:"w-full py-6 text-lg font-bold",children:a(d?"common.processing":"flatten.flattenButton")});return e.jsx(C,{title:a("tools.flatten-pdf.name"),description:a("tools.flatten-pdf.description"),hasFiles:!!s,onUpload:h,isProcessing:d,maxFiles:1,uploadTitle:a("common.selectFile"),uploadDescription:a("upload.singleFileAllowed"),actions:!l&&s?F():null,children:w()})};export{_ as FlattenPDF};
