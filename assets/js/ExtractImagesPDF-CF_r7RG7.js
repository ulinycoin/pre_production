import{e as K,u as Z,r as i,j as e,a as x,U as H,an as V,K as C,I as T,B as W,L as E,p as f}from"./index-BaqsOxPK.js";import{T as J}from"./ToolLayout-pcKgwv4w.js";import{s as Q}from"./smartImageFilterService-TF3bgHdk.js";import{T as X,a as Y,b as R}from"./tabs-weqf3qnD.js";import{D as $}from"./download-0nOk4Jfy.js";import{S as ee}from"./sparkles-GNV_4AVK.js";import"./vendor-react-CTjRfaZN.js";import"./vendor-pdfjs-BlOy0ZkI.js";import"./vendor-pdf-lib-CZHCEpXA.js";import"./vendor-word-CeUssL8V.js";import"./vendor-ocr-CTFn7PEu.js";import"./FileUpload-DUSj1Bnl.js";const te=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],se=K("funnel",te),ue=()=>{const{t:s}=Z(),[c,I]=i.useState(null),[g,p]=i.useState(!1),[o,b]=i.useState([]),[v,S]=i.useState([]),[k,F]=i.useState(null),[n,d]=i.useState(new Set),[u,h]=i.useState(null),[l,B]=i.useState("extract"),[w,N]=i.useState("all"),[j]=i.useState(!0),D=t=>{t.length>0&&(I(t[0]),h(null),b([]),S([]),F(null),d(new Set),N("all"))},L=async()=>{if(c){p(!0),h(null),b([]),d(new Set);try{const t=await f.extractImages(c,()=>{});if(t.success&&t.data)if(b(t.data),j&&t.data.length>0){const a=await Q.analyzeImages(t.data);if(j&&t.data.length>0){F(a);const r=a.categories.flatMap(m=>m.images);if(S(r),l==="extract"){const m=a.usefulImages.map(y=>y.id);d(new Set(m.length>0?m:t.data.map(y=>y.id))),h(t)}else d(new Set(t.data.map(m=>m.id)))}else d(new Set(t.data.map(r=>r.id))),l==="extract"&&h(t)}else h(t)}catch(t){console.error("Operation failed:",t),h({success:!1,error:{code:"PROCESSING_FAILED",message:t instanceof Error?t.message:"Operation failed"}})}finally{p(!1)}}},M=async()=>{if(!(!c||n.size===0)){p(!0);try{const t=Array.from(n),a=await f.removeSelectedImages(c,t,o,()=>{});h(a)}catch(t){console.error("Remove failed:",t),h({success:!1,error:{code:"PROCESSING_FAILED",message:t instanceof Error?t.message:"Remove failed"}})}finally{p(!1)}}},P=t=>{d(a=>{const r=new Set(a);return r.has(t)?r.delete(t):r.add(t),r})},_=()=>{n.size===o.length?d(new Set):d(new Set(o.map(t=>t.id)))},z=async()=>{if(l==="extract"&&o.length>0){const t=o.filter(r=>n.has(r.id));if(t.length===0){alert(s("extractImages.noImagesSelected")||"Please select at least one image.");return}const a=c?.name.replace(/\.pdf$/i,"")||"images";if(t.length===1)f.downloadFile(t[0].blob,t[0].filename);else{const r=t.map(m=>({blob:m.blob,filename:m.filename}));await f.downloadAsZip(r,`${a}_images.zip`)}}else if(l==="remove"&&u?.success&&u.data&&!(u.data instanceof Array)){const t=c?.name.replace(/\.pdf$/i,"")||"document";f.downloadFile(u.data,`${t}_no_images.pdf`)}},O=t=>{if(t===0)return"0 B";const a=1024,r=Math.floor(Math.log(t)/Math.log(a));return`${(t/Math.pow(a,r)).toFixed(1)} ${["B","KB","MB","GB"][r]}`},A=()=>{L()},U=()=>!j||v.length===0?o:w==="all"?v:v.filter(t=>t.category===w),q=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(E,{children:s("extractImages.mode")||"Operation Mode"}),e.jsx(X,{value:l,onValueChange:t=>B(t),className:"w-full",children:e.jsxs(Y,{className:"grid w-full grid-cols-2",children:[e.jsx(R,{value:"extract",children:s("extractImages.modeExtract")||"Extract"}),e.jsx(R,{value:"remove",children:s("extractImages.modeRemove")||"Remove"})]})}),e.jsx("p",{className:"text-sm text-gray-500",children:l==="extract"?s("extractImages.extractDescription")||"Extract images from PDF.":s("extractImages.removeDescription")||"Remove images to reduce size."})]}),j&&k&&l==="extract"&&e.jsxs("div",{className:"space-y-3 pt-4 border-t border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(se,{className:"w-4 h-4 text-accent-blue"}),e.jsx(E,{children:s("extractImages.smartFilter.quickFilters")})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(x,{variant:w==="all"?"default":"outline",size:"sm",onClick:()=>N("all"),children:["All (",o.length,")"]}),k.categories.map(t=>e.jsxs(x,{variant:w===t.category?"default":"outline",size:"sm",onClick:()=>N(t.category),children:[s(`extractImages.smartFilter.categories.${t.category}`)," (",t.count,")"]},t.category))]})]})]}),G=()=>{if(u?.success&&l==="remove")return e.jsxs("div",{className:"text-center space-y-8 py-12",children:[e.jsx("div",{className:"w-24 h-24 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto shadow-lg shadow-green-500/20",children:e.jsx(C,{className:"w-12 h-12 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:s("common.success")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-lg",children:s("extractImages.successRemove")})]}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsxs(x,{onClick:z,size:"lg",className:"h-14 px-8 rounded-2xl font-bold bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-200 dark:shadow-none transition-all",children:[e.jsx($,{className:"w-5 h-5 mr-2"}),s("common.download")]}),e.jsx(x,{onClick:()=>I(null),variant:"outline",size:"lg",className:"h-14 px-8 rounded-2xl font-bold border-2",children:s("common.processAnother")})]})]});if(o.length>0){const t=U();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between pb-2 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-accent-blue/10",children:e.jsx(T,{className:"w-5 h-5 text-accent-blue"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:s(l==="extract"?"extractImages.previewTitle":"extractImages.previewTitleRemove")})]}),e.jsx(x,{variant:"ghost",size:"sm",onClick:_,className:"text-accent-blue hover:bg-accent-blue/10 font-medium",children:n.size===o.length?s("split.deselectAll"):s("extractImages.selectAll")})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6 overflow-y-auto p-1 custom-scrollbar min-h-[400px]",children:t.map(a=>e.jsxs("div",{className:`
                                    relative group rounded-[1.5rem] border-2 cursor-pointer overflow-hidden transition-all duration-300
                                    ${n.has(a.id)?"border-accent-blue bg-accent-blue/5 shadow-lg shadow-accent-blue/10 scale-[1.02]":"border-white/10 dark:border-white/5 bg-white/5 hover:border-white/30 hover:bg-white/10"}
                                `,onClick:()=>P(a.id),children:[e.jsx("div",{className:`absolute top-3 left-3 z-10 w-6 h-6 rounded-md border-2 flex items-center justify-center transition-colors ${n.has(a.id)?"bg-accent-blue border-accent-blue":"border-white/40 bg-black/20"}`,children:n.has(a.id)&&e.jsx(C,{className:"w-4 h-4 text-white"})}),a.category&&a.category!=="other"&&e.jsx("div",{className:"absolute top-3 right-3 z-10",children:e.jsx(W,{variant:"secondary",className:"bg-black/40 backdrop-blur-md border border-white/10 text-[10px] uppercase tracking-wider",children:s(`extractImages.smartFilter.categories.${a.category}`)})}),e.jsx("div",{className:"aspect-square flex items-center justify-center p-4",children:a.previewUrl&&e.jsx("img",{src:a.previewUrl,alt:a.filename,className:"max-w-full max-h-full object-contain drop-shadow-md group-hover:scale-110 transition-transform duration-500"})}),e.jsx("div",{className:"px-4 py-2 bg-black/20 backdrop-blur-sm border-t border-white/5 text-[10px] text-gray-400 truncate",children:a.filename})]},a.id))})]})}return c&&!u?e.jsxs("div",{className:"text-center py-20 space-y-6",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{className:"w-24 h-24 bg-accent-blue/10 rounded-[2rem] flex items-center justify-center mx-auto text-accent-blue animate-pulse-slow",children:e.jsx(T,{className:"w-12 h-12"})}),e.jsx("div",{className:"absolute -top-2 -right-2 w-8 h-8 bg-accent-blue rounded-full flex items-center justify-center text-white shadow-lg animate-bounce duration-3000",children:e.jsx(ee,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:c.name}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 font-medium",children:O(c.size||0)})]}),e.jsx("p",{className:"text-lg text-gray-500",children:s("ocr.analyzingContent")}),e.jsx(x,{onClick:A,disabled:g,className:"h-16 px-10 rounded-2xl text-xl font-bold bg-accent-blue hover:bg-accent-blue/90 text-white shadow-xl shadow-accent-blue/20 transition-all hover:scale-105",children:s(g?"common.processing":"extractImages.removeBtn")})]}):null};return e.jsx(J,{title:s("tools.extract-images-pdf.name"),description:s("tools.extract-images-pdf.description"),hasFiles:!!c,onUpload:D,isProcessing:g,maxFiles:1,uploadTitle:s("common.selectFile"),uploadDescription:s("upload.singleFileAllowed"),acceptedTypes:".pdf",settings:c?q():null,actions:c&&!u?.success?o.length===0?e.jsx(x,{onClick:A,disabled:g,className:"w-full h-12 rounded-xl font-bold bg-accent-blue text-white shadow-lg shadow-accent-blue/10",children:g?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2",children:"⏳"})," ",s("common.processing")]}):s("extractImages.removeBtn")}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(x,{onClick:l==="extract"?z:M,disabled:g||n.size===0,className:`w-full h-14 rounded-xl text-lg font-bold text-white shadow-lg transition-all ${l==="extract"?"bg-accent-blue hover:bg-accent-blue/90 shadow-accent-blue/20":"bg-red-500 hover:bg-red-600 shadow-red-500/20"}`,children:g?e.jsx("span",{className:"animate-spin",children:"⏳"}):l==="extract"?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-5 h-5 mr-2"})," ",s("extractImages.downloadSelected",{count:n.size})]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-5 h-5 mr-2"})," ",s("extractImages.removeSelected",{count:n.size})]})}),e.jsxs(x,{onClick:()=>{b([]),d(new Set)},variant:"ghost",className:"w-full h-12 rounded-xl text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),s("common.back")]})]}):null,sidebarWidth:"w-80",children:G()})};export{ue as ExtractImagesPDF};
