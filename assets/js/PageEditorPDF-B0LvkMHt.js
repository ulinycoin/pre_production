import{e as Tn,r as l,R as _,aa as _e,u as kt,j as i,B as Ie,a as q,J as Ln,b as Fn,p as ce,t as Y,X as $n,K as Bn,M as Un,S as Xn,U as on,H as Wn,O as Hn}from"./index-BaqsOxPK.js";import{C as Le,a as ot,T as Yn}from"./ToolLayout-pcKgwv4w.js";import{D as Wt}from"./DownloadGate-DG4D_ywK.js";import{C as _n}from"./checkbox-tiR4FlQJ.js";import{u as Kn}from"./usePDFThumbnails-DmbB4CMY.js";import{s as Ht}from"./smartOrganizeService-A4xCQtas.js";import{R as qn}from"./refresh-cw-CE5DMPth.js";import{S as Gn}from"./square-check-big-DMLraRHA.js";import{S as Vn}from"./square-BEhVwQvH.js";import{D as Zn}from"./download-0nOk4Jfy.js";import{P as Jn}from"./plus-DJCSgA73.js";import{Z as Qn}from"./zoom-in-BLBJcUI6.js";import"./vendor-react-CTjRfaZN.js";import"./vendor-pdfjs-BlOy0ZkI.js";import"./vendor-pdf-lib-CZHCEpXA.js";import"./vendor-word-CeUssL8V.js";import"./vendor-ocr-CTFn7PEu.js";import"./FileUpload-DUSj1Bnl.js";import"./index-BcRrjoDw.js";const er=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],tr=Tn("refresh-ccw",er);function nr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return l.useMemo(()=>r=>{t.forEach(s=>s(r))},t)}const gt=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function $e(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function It(e){return"nodeType"in e}function G(e){var t,n;return e?$e(e)?e:It(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function At(e){const{Document:t}=G(e);return e instanceof t}function et(e){return $e(e)?!1:e instanceof G(e).HTMLElement}function an(e){return e instanceof G(e).SVGElement}function Be(e){return e?$e(e)?e.document:It(e)?At(e)?e:et(e)||an(e)?e.ownerDocument:document:document:document}const he=gt?l.useLayoutEffect:l.useEffect;function Mt(e){const t=l.useRef(e);return he(()=>{t.current=e}),l.useCallback(function(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return t.current==null?void 0:t.current(...r)},[])}function rr(){const e=l.useRef(null),t=l.useCallback((r,s)=>{e.current=setInterval(r,s)},[]),n=l.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function Ve(e,t){t===void 0&&(t=[e]);const n=l.useRef(e);return he(()=>{n.current!==e&&(n.current=e)},t),n}function tt(e,t){const n=l.useRef();return l.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...t])}function ct(e){const t=Mt(e),n=l.useRef(null),r=l.useCallback(s=>{s!==n.current&&t?.(s,n.current),n.current=s},[]);return[n,r]}function Nt(e){const t=l.useRef();return l.useEffect(()=>{t.current=e},[e]),t.current}let yt={};function nt(e,t){return l.useMemo(()=>{if(t)return t;const n=yt[e]==null?0:yt[e]+1;return yt[e]=n,e+"-"+n},[e,t])}function ln(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return r.reduce((o,a)=>{const c=Object.entries(a);for(const[d,u]of c){const g=o[d];g!=null&&(o[d]=g+e*u)}return o},{...t})}}const Fe=ln(1),Ze=ln(-1);function sr(e){return"clientX"in e&&"clientY"in e}function zt(e){if(!e)return!1;const{KeyboardEvent:t}=G(e.target);return t&&e instanceof t}function or(e){if(!e)return!1;const{TouchEvent:t}=G(e.target);return t&&e instanceof t}function Ct(e){if(or(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return sr(e)?{x:e.clientX,y:e.clientY}:null}const Je=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[Je.Translate.toString(e),Je.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),Yt="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function ar(e){return e.matches(Yt)?e:e.querySelector(Yt)}const ir={display:"none"};function lr(e){let{id:t,value:n}=e;return _.createElement("div",{id:t,style:ir},n)}function cr(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;const s={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return _.createElement("div",{id:t,style:s,role:"status","aria-live":r,"aria-atomic":!0},n)}function dr(){const[e,t]=l.useState("");return{announce:l.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const cn=l.createContext(null);function ur(e){const t=l.useContext(cn);l.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function fr(){const[e]=l.useState(()=>new Set),t=l.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[l.useCallback(r=>{let{type:s,event:o}=r;e.forEach(a=>{var c;return(c=a[s])==null?void 0:c.call(a,o)})},[e]),t]}const gr={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},hr={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function pr(e){let{announcements:t=hr,container:n,hiddenTextDescribedById:r,screenReaderInstructions:s=gr}=e;const{announce:o,announcement:a}=dr(),c=nt("DndLiveRegion"),[d,u]=l.useState(!1);if(l.useEffect(()=>{u(!0)},[]),ur(l.useMemo(()=>({onDragStart(f){let{active:m}=f;o(t.onDragStart({active:m}))},onDragMove(f){let{active:m,over:b}=f;t.onDragMove&&o(t.onDragMove({active:m,over:b}))},onDragOver(f){let{active:m,over:b}=f;o(t.onDragOver({active:m,over:b}))},onDragEnd(f){let{active:m,over:b}=f;o(t.onDragEnd({active:m,over:b}))},onDragCancel(f){let{active:m,over:b}=f;o(t.onDragCancel({active:m,over:b}))}}),[o,t])),!d)return null;const g=_.createElement(_.Fragment,null,_.createElement(lr,{id:r,value:s.draggable}),_.createElement(cr,{id:c,announcement:a}));return n?_e.createPortal(g,n):g}var F;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(F||(F={}));function dt(){}function _t(e,t){return l.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function mr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return l.useMemo(()=>[...t].filter(r=>r!=null),[...t])}const de=Object.freeze({x:0,y:0});function dn(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function un(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return n-r}function br(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function Kt(e){let{left:t,top:n,height:r,width:s}=e;return[{x:t,y:n},{x:t+s,y:n},{x:t,y:n+r},{x:t+s,y:n+r}]}function fn(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function qt(e,t,n){return t===void 0&&(t=e.left),n===void 0&&(n=e.top),{x:t+e.width*.5,y:n+e.height*.5}}const vr=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const s=qt(t,t.left,t.top),o=[];for(const a of r){const{id:c}=a,d=n.get(c);if(d){const u=dn(qt(d),s);o.push({id:c,data:{droppableContainer:a,value:u}})}}return o.sort(un)},xr=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const s=Kt(t),o=[];for(const a of r){const{id:c}=a,d=n.get(c);if(d){const u=Kt(d),g=s.reduce((m,b,N)=>m+dn(u[N],b),0),f=Number((g/4).toFixed(4));o.push({id:c,data:{droppableContainer:a,value:f}})}}return o.sort(un)};function yr(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),s=Math.min(t.left+t.width,e.left+e.width),o=Math.min(t.top+t.height,e.top+e.height),a=s-r,c=o-n;if(r<s&&n<o){const d=t.width*t.height,u=e.width*e.height,g=a*c,f=g/(d+u-g);return Number(f.toFixed(4))}return 0}const wr=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const s=[];for(const o of r){const{id:a}=o,c=n.get(a);if(c){const d=yr(c,t);d>0&&s.push({id:a,data:{droppableContainer:o,value:d}})}}return s.sort(br)};function Dr(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function gn(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:de}function Sr(e){return function(n){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return s.reduce((a,c)=>({...a,top:a.top+e*c.y,bottom:a.bottom+e*c.y,left:a.left+e*c.x,right:a.right+e*c.x}),{...n})}}const Nr=Sr(1);function Cr(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function jr(e,t,n){const r=Cr(t);if(!r)return e;const{scaleX:s,scaleY:o,x:a,y:c}=r,d=e.left-a-(1-s)*parseFloat(n),u=e.top-c-(1-o)*parseFloat(n.slice(n.indexOf(" ")+1)),g=s?e.width/s:e.width,f=o?e.height/o:e.height;return{width:g,height:f,top:u,right:d+g,bottom:u+f,left:d}}const Rr={ignoreTransform:!1};function Ue(e,t){t===void 0&&(t=Rr);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:u,transformOrigin:g}=G(e).getComputedStyle(e);u&&(n=jr(n,u,g))}const{top:r,left:s,width:o,height:a,bottom:c,right:d}=n;return{top:r,left:s,width:o,height:a,bottom:c,right:d}}function Gt(e){return Ue(e,{ignoreTransform:!0})}function Er(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function kr(e,t){return t===void 0&&(t=G(e).getComputedStyle(e)),t.position==="fixed"}function Ir(e,t){t===void 0&&(t=G(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(s=>{const o=t[s];return typeof o=="string"?n.test(o):!1})}function ht(e,t){const n=[];function r(s){if(t!=null&&n.length>=t||!s)return n;if(At(s)&&s.scrollingElement!=null&&!n.includes(s.scrollingElement))return n.push(s.scrollingElement),n;if(!et(s)||an(s)||n.includes(s))return n;const o=G(e).getComputedStyle(s);return s!==e&&Ir(s,o)&&n.push(s),kr(s,o)?n:r(s.parentNode)}return e?r(e):n}function hn(e){const[t]=ht(e,1);return t??null}function wt(e){return!gt||!e?null:$e(e)?e:It(e)?At(e)||e===Be(e).scrollingElement?window:et(e)?e:null:null}function pn(e){return $e(e)?e.scrollX:e.scrollLeft}function mn(e){return $e(e)?e.scrollY:e.scrollTop}function jt(e){return{x:pn(e),y:mn(e)}}var $;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})($||($={}));function bn(e){return!gt||!e?!1:e===document.scrollingElement}function vn(e){const t={x:0,y:0},n=bn(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},s=e.scrollTop<=t.y,o=e.scrollLeft<=t.x,a=e.scrollTop>=r.y,c=e.scrollLeft>=r.x;return{isTop:s,isLeft:o,isBottom:a,isRight:c,maxScroll:r,minScroll:t}}const Ar={x:.2,y:.2};function Mr(e,t,n,r,s){let{top:o,left:a,right:c,bottom:d}=n;r===void 0&&(r=10),s===void 0&&(s=Ar);const{isTop:u,isBottom:g,isLeft:f,isRight:m}=vn(e),b={x:0,y:0},N={x:0,y:0},v={height:t.height*s.y,width:t.width*s.x};return!u&&o<=t.top+v.height?(b.y=$.Backward,N.y=r*Math.abs((t.top+v.height-o)/v.height)):!g&&d>=t.bottom-v.height&&(b.y=$.Forward,N.y=r*Math.abs((t.bottom-v.height-d)/v.height)),!m&&c>=t.right-v.width?(b.x=$.Forward,N.x=r*Math.abs((t.right-v.width-c)/v.width)):!f&&a<=t.left+v.width&&(b.x=$.Backward,N.x=r*Math.abs((t.left+v.width-a)/v.width)),{direction:b,speed:N}}function zr(e){if(e===document.scrollingElement){const{innerWidth:o,innerHeight:a}=window;return{top:0,left:0,right:o,bottom:a,width:o,height:a}}const{top:t,left:n,right:r,bottom:s}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:s,width:e.clientWidth,height:e.clientHeight}}function xn(e){return e.reduce((t,n)=>Fe(t,jt(n)),de)}function Or(e){return e.reduce((t,n)=>t+pn(n),0)}function Pr(e){return e.reduce((t,n)=>t+mn(n),0)}function Tr(e,t){if(t===void 0&&(t=Ue),!e)return;const{top:n,left:r,bottom:s,right:o}=t(e);hn(e)&&(s<=0||o<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const Lr=[["x",["left","right"],Or],["y",["top","bottom"],Pr]];class Ot{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=ht(n),s=xn(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[o,a,c]of Lr)for(const d of a)Object.defineProperty(this,d,{get:()=>{const u=c(r),g=s[o]-u;return this.rect[d]+g},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Ke{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=t}add(t,n,r){var s;(s=this.target)==null||s.addEventListener(t,n,r),this.listeners.push([t,n,r])}}function Fr(e){const{EventTarget:t}=G(e);return e instanceof t?e:Be(e)}function Dt(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t?r>t.y:!1}var re;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(re||(re={}));function Vt(e){e.preventDefault()}function $r(e){e.stopPropagation()}var A;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(A||(A={}));const yn={start:[A.Space,A.Enter],cancel:[A.Esc],end:[A.Space,A.Enter,A.Tab]},Br=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case A.Right:return{...n,x:n.x+25};case A.Left:return{...n,x:n.x-25};case A.Down:return{...n,y:n.y+25};case A.Up:return{...n,y:n.y-25}}};class Pt{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new Ke(Be(n)),this.windowListeners=new Ke(G(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(re.Resize,this.handleCancel),this.windowListeners.add(re.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(re.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,r=t.node.current;r&&Tr(r),n(de)}handleKeyDown(t){if(zt(t)){const{active:n,context:r,options:s}=this.props,{keyboardCodes:o=yn,coordinateGetter:a=Br,scrollBehavior:c="smooth"}=s,{code:d}=t;if(o.end.includes(d)){this.handleEnd(t);return}if(o.cancel.includes(d)){this.handleCancel(t);return}const{collisionRect:u}=r.current,g=u?{x:u.left,y:u.top}:de;this.referenceCoordinates||(this.referenceCoordinates=g);const f=a(t,{active:n,context:r.current,currentCoordinates:g});if(f){const m=Ze(f,g),b={x:0,y:0},{scrollableAncestors:N}=r.current;for(const v of N){const w=t.code,{isTop:D,isRight:E,isLeft:j,isBottom:k,maxScroll:I,minScroll:y}=vn(v),S=zr(v),C={x:Math.min(w===A.Right?S.right-S.width/2:S.right,Math.max(w===A.Right?S.left:S.left+S.width/2,f.x)),y:Math.min(w===A.Down?S.bottom-S.height/2:S.bottom,Math.max(w===A.Down?S.top:S.top+S.height/2,f.y))},O=w===A.Right&&!E||w===A.Left&&!j,P=w===A.Down&&!k||w===A.Up&&!D;if(O&&C.x!==f.x){const z=v.scrollLeft+m.x,B=w===A.Right&&z<=I.x||w===A.Left&&z>=y.x;if(B&&!m.y){v.scrollTo({left:z,behavior:c});return}B?b.x=v.scrollLeft-z:b.x=w===A.Right?v.scrollLeft-I.x:v.scrollLeft-y.x,b.x&&v.scrollBy({left:-b.x,behavior:c});break}else if(P&&C.y!==f.y){const z=v.scrollTop+m.y,B=w===A.Down&&z<=I.y||w===A.Up&&z>=y.y;if(B&&!m.x){v.scrollTo({top:z,behavior:c});return}B?b.y=v.scrollTop-z:b.y=w===A.Down?v.scrollTop-I.y:v.scrollTop-y.y,b.y&&v.scrollBy({top:-b.y,behavior:c});break}}this.handleMove(t,Fe(Ze(f,this.referenceCoordinates),b))}}}handleMove(t,n){const{onMove:r}=this.props;t.preventDefault(),r(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Pt.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=yn,onActivation:s}=t,{active:o}=n;const{code:a}=e.nativeEvent;if(r.start.includes(a)){const c=o.activatorNode.current;return c&&e.target!==c?!1:(e.preventDefault(),s?.({event:e.nativeEvent}),!0)}return!1}}];function Zt(e){return!!(e&&"distance"in e)}function Jt(e){return!!(e&&"delay"in e)}class Tt{constructor(t,n,r){var s;r===void 0&&(r=Fr(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:o}=t,{target:a}=o;this.props=t,this.events=n,this.document=Be(a),this.documentListeners=new Ke(this.document),this.listeners=new Ke(r),this.windowListeners=new Ke(G(a)),this.initialCoordinates=(s=Ct(o))!=null?s:de,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(re.Resize,this.handleCancel),this.windowListeners.add(re.DragStart,Vt),this.windowListeners.add(re.VisibilityChange,this.handleCancel),this.windowListeners.add(re.ContextMenu,Vt),this.documentListeners.add(re.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Jt(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(Zt(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:r,onPending:s}=this.props;s(r,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(re.Click,$r,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(re.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:r,initialCoordinates:s,props:o}=this,{onMove:a,options:{activationConstraint:c}}=o;if(!s)return;const d=(n=Ct(t))!=null?n:de,u=Ze(s,d);if(!r&&c){if(Zt(c)){if(c.tolerance!=null&&Dt(u,c.tolerance))return this.handleCancel();if(Dt(u,c.distance))return this.handleStart()}if(Jt(c)&&Dt(u,c.tolerance))return this.handleCancel();this.handlePending(c,u);return}t.cancelable&&t.preventDefault(),a(d)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===A.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const Ur={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Lt extends Tt{constructor(t){const{event:n}=t,r=Be(n.target);super(t,Ur,r)}}Lt.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!n.isPrimary||n.button!==0?!1:(r?.({event:n}),!0)}}];const Xr={move:{name:"mousemove"},end:{name:"mouseup"}};var Rt;(function(e){e[e.RightClick=2]="RightClick"})(Rt||(Rt={}));class Wr extends Tt{constructor(t){super(t,Xr,Be(t.event.target))}}Wr.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button===Rt.RightClick?!1:(r?.({event:n}),!0)}}];const St={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Hr extends Tt{constructor(t){super(t,St)}static setup(){return window.addEventListener(St.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(St.move.name,t)};function t(){}}}Hr.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:s}=n;return s.length>1?!1:(r?.({event:n}),!0)}}];var qe;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(qe||(qe={}));var ut;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(ut||(ut={}));function Yr(e){let{acceleration:t,activator:n=qe.Pointer,canScroll:r,draggingRect:s,enabled:o,interval:a=5,order:c=ut.TreeOrder,pointerCoordinates:d,scrollableAncestors:u,scrollableAncestorRects:g,delta:f,threshold:m}=e;const b=Kr({delta:f,disabled:!o}),[N,v]=rr(),w=l.useRef({x:0,y:0}),D=l.useRef({x:0,y:0}),E=l.useMemo(()=>{switch(n){case qe.Pointer:return d?{top:d.y,bottom:d.y,left:d.x,right:d.x}:null;case qe.DraggableRect:return s}},[n,s,d]),j=l.useRef(null),k=l.useCallback(()=>{const y=j.current;if(!y)return;const S=w.current.x*D.current.x,C=w.current.y*D.current.y;y.scrollBy(S,C)},[]),I=l.useMemo(()=>c===ut.TreeOrder?[...u].reverse():u,[c,u]);l.useEffect(()=>{if(!o||!u.length||!E){v();return}for(const y of I){if(r?.(y)===!1)continue;const S=u.indexOf(y),C=g[S];if(!C)continue;const{direction:O,speed:P}=Mr(y,C,E,t,m);for(const z of["x","y"])b[z][O[z]]||(P[z]=0,O[z]=0);if(P.x>0||P.y>0){v(),j.current=y,N(k,a),w.current=P,D.current=O;return}}w.current={x:0,y:0},D.current={x:0,y:0},v()},[t,k,r,v,o,a,JSON.stringify(E),JSON.stringify(b),N,u,I,g,JSON.stringify(m)])}const _r={x:{[$.Backward]:!1,[$.Forward]:!1},y:{[$.Backward]:!1,[$.Forward]:!1}};function Kr(e){let{delta:t,disabled:n}=e;const r=Nt(t);return tt(s=>{if(n||!r||!s)return _r;const o={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[$.Backward]:s.x[$.Backward]||o.x===-1,[$.Forward]:s.x[$.Forward]||o.x===1},y:{[$.Backward]:s.y[$.Backward]||o.y===-1,[$.Forward]:s.y[$.Forward]||o.y===1}}},[n,t,r])}function qr(e,t){const n=t!=null?e.get(t):void 0,r=n?n.node.current:null;return tt(s=>{var o;return t==null?null:(o=r??s)!=null?o:null},[r,t])}function Gr(e,t){return l.useMemo(()=>e.reduce((n,r)=>{const{sensor:s}=r,o=s.activators.map(a=>({eventName:a.eventName,handler:t(a.handler,r)}));return[...n,...o]},[]),[e,t])}var Qe;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(Qe||(Qe={}));var Et;(function(e){e.Optimized="optimized"})(Et||(Et={}));const Qt=new Map;function Vr(e,t){let{dragging:n,dependencies:r,config:s}=t;const[o,a]=l.useState(null),{frequency:c,measure:d,strategy:u}=s,g=l.useRef(e),f=w(),m=Ve(f),b=l.useCallback(function(D){D===void 0&&(D=[]),!m.current&&a(E=>E===null?D:E.concat(D.filter(j=>!E.includes(j))))},[m]),N=l.useRef(null),v=tt(D=>{if(f&&!n)return Qt;if(!D||D===Qt||g.current!==e||o!=null){const E=new Map;for(let j of e){if(!j)continue;if(o&&o.length>0&&!o.includes(j.id)&&j.rect.current){E.set(j.id,j.rect.current);continue}const k=j.node.current,I=k?new Ot(d(k),k):null;j.rect.current=I,I&&E.set(j.id,I)}return E}return D},[e,o,n,f,d]);return l.useEffect(()=>{g.current=e},[e]),l.useEffect(()=>{f||b()},[n,f]),l.useEffect(()=>{o&&o.length>0&&a(null)},[JSON.stringify(o)]),l.useEffect(()=>{f||typeof c!="number"||N.current!==null||(N.current=setTimeout(()=>{b(),N.current=null},c))},[c,f,b,...r]),{droppableRects:v,measureDroppableContainers:b,measuringScheduled:o!=null};function w(){switch(u){case Qe.Always:return!1;case Qe.BeforeDragging:return n;default:return!n}}}function wn(e,t){return tt(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function Zr(e,t){return wn(e,t)}function Jr(e){let{callback:t,disabled:n}=e;const r=Mt(t),s=l.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(r)},[r,n]);return l.useEffect(()=>()=>s?.disconnect(),[s]),s}function pt(e){let{callback:t,disabled:n}=e;const r=Mt(t),s=l.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(r)},[n]);return l.useEffect(()=>()=>s?.disconnect(),[s]),s}function Qr(e){return new Ot(Ue(e),e)}function en(e,t,n){t===void 0&&(t=Qr);const[r,s]=l.useState(null);function o(){s(d=>{if(!e)return null;if(e.isConnected===!1){var u;return(u=d??n)!=null?u:null}const g=t(e);return JSON.stringify(d)===JSON.stringify(g)?d:g})}const a=Jr({callback(d){if(e)for(const u of d){const{type:g,target:f}=u;if(g==="childList"&&f instanceof HTMLElement&&f.contains(e)){o();break}}}}),c=pt({callback:o});return he(()=>{o(),e?(c?.observe(e),a?.observe(document.body,{childList:!0,subtree:!0})):(c?.disconnect(),a?.disconnect())},[e]),r}function es(e){const t=wn(e);return gn(e,t)}const tn=[];function ts(e){const t=l.useRef(e),n=tt(r=>e?r&&r!==tn&&e&&t.current&&e.parentNode===t.current.parentNode?r:ht(e):tn,[e]);return l.useEffect(()=>{t.current=e},[e]),n}function ns(e){const[t,n]=l.useState(null),r=l.useRef(e),s=l.useCallback(o=>{const a=wt(o.target);a&&n(c=>c?(c.set(a,jt(a)),new Map(c)):null)},[]);return l.useEffect(()=>{const o=r.current;if(e!==o){a(o);const c=e.map(d=>{const u=wt(d);return u?(u.addEventListener("scroll",s,{passive:!0}),[u,jt(u)]):null}).filter(d=>d!=null);n(c.length?new Map(c):null),r.current=e}return()=>{a(e),a(o)};function a(c){c.forEach(d=>{const u=wt(d);u?.removeEventListener("scroll",s)})}},[s,e]),l.useMemo(()=>e.length?t?Array.from(t.values()).reduce((o,a)=>Fe(o,a),de):xn(e):de,[e,t])}function nn(e,t){t===void 0&&(t=[]);const n=l.useRef(null);return l.useEffect(()=>{n.current=null},t),l.useEffect(()=>{const r=e!==de;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?Ze(e,n.current):de}function rs(e){l.useEffect(()=>{if(!gt)return;const t=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of t)n?.()}},e.map(t=>{let{sensor:n}=t;return n}))}function ss(e,t){return l.useMemo(()=>e.reduce((n,r)=>{let{eventName:s,handler:o}=r;return n[s]=a=>{o(a,t)},n},{}),[e,t])}function Dn(e){return l.useMemo(()=>e?Er(e):null,[e])}const rn=[];function os(e,t){t===void 0&&(t=Ue);const[n]=e,r=Dn(n?G(n):null),[s,o]=l.useState(rn);function a(){o(()=>e.length?e.map(d=>bn(d)?r:new Ot(t(d),d)):rn)}const c=pt({callback:a});return he(()=>{c?.disconnect(),a(),e.forEach(d=>c?.observe(d))},[e]),s}function as(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return et(t)?t:e}function is(e){let{measure:t}=e;const[n,r]=l.useState(null),s=l.useCallback(u=>{for(const{target:g}of u)if(et(g)){r(f=>{const m=t(g);return f?{...f,width:m.width,height:m.height}:m});break}},[t]),o=pt({callback:s}),a=l.useCallback(u=>{const g=as(u);o?.disconnect(),g&&o?.observe(g),r(g?t(g):null)},[t,o]),[c,d]=ct(a);return l.useMemo(()=>({nodeRef:c,rect:n,setRef:d}),[n,c,d])}const ls=[{sensor:Lt,options:{}},{sensor:Pt,options:{}}],cs={current:{}},lt={draggable:{measure:Gt},droppable:{measure:Gt,strategy:Qe.WhileDragging,frequency:Et.Optimized},dragOverlay:{measure:Ue}};class Ge extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,r;return(n=(r=this.get(t))==null?void 0:r.node.current)!=null?n:void 0}}const ds={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Ge,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:dt},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:lt,measureDroppableContainers:dt,windowRect:null,measuringScheduled:!1},us={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:dt,draggableNodes:new Map,over:null,measureDroppableContainers:dt},mt=l.createContext(us),Sn=l.createContext(ds);function fs(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Ge}}}function gs(e,t){switch(t.type){case F.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case F.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case F.DragEnd:case F.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case F.RegisterDroppable:{const{element:n}=t,{id:r}=n,s=new Ge(e.droppable.containers);return s.set(r,n),{...e,droppable:{...e.droppable,containers:s}}}case F.SetDroppableDisabled:{const{id:n,key:r,disabled:s}=t,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const a=new Ge(e.droppable.containers);return a.set(n,{...o,disabled:s}),{...e,droppable:{...e.droppable,containers:a}}}case F.UnregisterDroppable:{const{id:n,key:r}=t,s=e.droppable.containers.get(n);if(!s||r!==s.key)return e;const o=new Ge(e.droppable.containers);return o.delete(n),{...e,droppable:{...e.droppable,containers:o}}}default:return e}}function hs(e){let{disabled:t}=e;const{active:n,activatorEvent:r,draggableNodes:s}=l.useContext(mt),o=Nt(r),a=Nt(n?.id);return l.useEffect(()=>{if(!t&&!r&&o&&a!=null){if(!zt(o)||document.activeElement===o.target)return;const c=s.get(a);if(!c)return;const{activatorNode:d,node:u}=c;if(!d.current&&!u.current)return;requestAnimationFrame(()=>{for(const g of[d.current,u.current]){if(!g)continue;const f=ar(g);if(f){f.focus();break}}})}},[r,t,s,a,o]),null}function ps(e,t){let{transform:n,...r}=t;return e!=null&&e.length?e.reduce((s,o)=>o({transform:s,...r}),n):n}function ms(e){return l.useMemo(()=>({draggable:{...lt.draggable,...e?.draggable},droppable:{...lt.droppable,...e?.droppable},dragOverlay:{...lt.dragOverlay,...e?.dragOverlay}}),[e?.draggable,e?.droppable,e?.dragOverlay])}function bs(e){let{activeNode:t,measure:n,initialRect:r,config:s=!0}=e;const o=l.useRef(!1),{x:a,y:c}=typeof s=="boolean"?{x:s,y:s}:s;he(()=>{if(!a&&!c||!t){o.current=!1;return}if(o.current||!r)return;const u=t?.node.current;if(!u||u.isConnected===!1)return;const g=n(u),f=gn(g,r);if(a||(f.x=0),c||(f.y=0),o.current=!0,Math.abs(f.x)>0||Math.abs(f.y)>0){const m=hn(u);m&&m.scrollBy({top:f.y,left:f.x})}},[t,a,c,r,n])}const Nn=l.createContext({...de,scaleX:1,scaleY:1});var Ne;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Ne||(Ne={}));const vs=l.memo(function(t){var n,r,s,o;let{id:a,accessibility:c,autoScroll:d=!0,children:u,sensors:g=ls,collisionDetection:f=wr,measuring:m,modifiers:b,...N}=t;const v=l.useReducer(gs,void 0,fs),[w,D]=v,[E,j]=fr(),[k,I]=l.useState(Ne.Uninitialized),y=k===Ne.Initialized,{draggable:{active:S,nodes:C,translate:O},droppable:{containers:P}}=w,z=S!=null?C.get(S):null,B=l.useRef({initial:null,translated:null}),V=l.useMemo(()=>{var W;return S!=null?{id:S,data:(W=z?.data)!=null?W:cs,rect:B}:null},[S,z]),ee=l.useRef(null),[Ce,je]=l.useState(null),[H,Ae]=l.useState(null),se=Ve(N,Object.values(N)),Re=nt("DndDescribedBy",a),Me=l.useMemo(()=>P.getEnabled(),[P]),X=ms(m),{droppableRects:oe,measureDroppableContainers:pe,measuringScheduled:Ee}=Vr(Me,{dragging:y,dependencies:[O.x,O.y],config:X.droppable}),K=qr(C,S),ze=l.useMemo(()=>H?Ct(H):null,[H]),ue=Pn(),ae=Zr(K,X.draggable.measure);bs({activeNode:S!=null?C.get(S):null,config:ue.layoutShiftCompensation,initialRect:ae,measure:X.draggable.measure});const M=en(K,X.draggable.measure,ae),ke=en(K?K.parentElement:null),te=l.useRef({activatorEvent:null,active:null,activeNode:K,collisionRect:null,collisions:null,droppableRects:oe,draggableNodes:C,draggingNode:null,draggingNodeRect:null,droppableContainers:P,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),xe=P.getNodeFor((n=te.current.over)==null?void 0:n.id),ie=is({measure:X.dragOverlay.measure}),me=(r=ie.nodeRef.current)!=null?r:K,be=y?(s=ie.rect)!=null?s:M:null,rt=!!(ie.nodeRef.current&&ie.rect),st=es(rt?null:M),h=Dn(me?G(me):null),p=ts(y?xe??K:null),x=os(p),R=ps(b,{transform:{x:O.x-st.x,y:O.y-st.y,scaleX:1,scaleY:1},activatorEvent:H,active:V,activeNodeRect:M,containerNodeRect:ke,draggingNodeRect:be,over:te.current.over,overlayNodeRect:ie.rect,scrollableAncestors:p,scrollableAncestorRects:x,windowRect:h}),T=ze?Fe(ze,O):null,L=ns(p),le=nn(L),bt=nn(L,[M]),Oe=Fe(R,le),Pe=be?Nr(be,R):null,Xe=V&&Pe?f({active:V,collisionRect:Pe,droppableRects:oe,droppableContainers:Me,pointerCoordinates:T}):null,$t=fn(Xe,"id"),[ye,Bt]=l.useState(null),In=rt?R:Fe(R,bt),An=Dr(In,(o=ye?.rect)!=null?o:null,M),vt=l.useRef(null),Ut=l.useCallback((W,Z)=>{let{sensor:J,options:we}=Z;if(ee.current==null)return;const ne=C.get(ee.current);if(!ne)return;const Q=W.nativeEvent,fe=new J({active:ee.current,activeNode:ne,event:Q,options:we,context:te,onAbort(U){if(!C.get(U))return;const{onDragAbort:ge}=se.current,ve={id:U};ge?.(ve),E({type:"onDragAbort",event:ve})},onPending(U,De,ge,ve){if(!C.get(U))return;const{onDragPending:He}=se.current,Se={id:U,constraint:De,initialCoordinates:ge,offset:ve};He?.(Se),E({type:"onDragPending",event:Se})},onStart(U){const De=ee.current;if(De==null)return;const ge=C.get(De);if(!ge)return;const{onDragStart:ve}=se.current,We={activatorEvent:Q,active:{id:De,data:ge.data,rect:B}};_e.unstable_batchedUpdates(()=>{ve?.(We),I(Ne.Initializing),D({type:F.DragStart,initialCoordinates:U,active:De}),E({type:"onDragStart",event:We}),je(vt.current),Ae(Q)})},onMove(U){D({type:F.DragMove,coordinates:U})},onEnd:Te(F.DragEnd),onCancel:Te(F.DragCancel)});vt.current=fe;function Te(U){return async function(){const{active:ge,collisions:ve,over:We,scrollAdjustedTranslate:He}=te.current;let Se=null;if(ge&&He){const{cancelDrop:Ye}=se.current;Se={activatorEvent:Q,active:ge,collisions:ve,delta:He,over:We},U===F.DragEnd&&typeof Ye=="function"&&await Promise.resolve(Ye(Se))&&(U=F.DragCancel)}ee.current=null,_e.unstable_batchedUpdates(()=>{D({type:U}),I(Ne.Uninitialized),Bt(null),je(null),Ae(null),vt.current=null;const Ye=U===F.DragEnd?"onDragEnd":"onDragCancel";if(Se){const xt=se.current[Ye];xt?.(Se),E({type:Ye,event:Se})}})}}},[C]),Mn=l.useCallback((W,Z)=>(J,we)=>{const ne=J.nativeEvent,Q=C.get(we);if(ee.current!==null||!Q||ne.dndKit||ne.defaultPrevented)return;const fe={active:Q};W(J,Z.options,fe)===!0&&(ne.dndKit={capturedBy:Z.sensor},ee.current=we,Ut(J,Z))},[C,Ut]),Xt=Gr(g,Mn);rs(g),he(()=>{M&&k===Ne.Initializing&&I(Ne.Initialized)},[M,k]),l.useEffect(()=>{const{onDragMove:W}=se.current,{active:Z,activatorEvent:J,collisions:we,over:ne}=te.current;if(!Z||!J)return;const Q={active:Z,activatorEvent:J,collisions:we,delta:{x:Oe.x,y:Oe.y},over:ne};_e.unstable_batchedUpdates(()=>{W?.(Q),E({type:"onDragMove",event:Q})})},[Oe.x,Oe.y]),l.useEffect(()=>{const{active:W,activatorEvent:Z,collisions:J,droppableContainers:we,scrollAdjustedTranslate:ne}=te.current;if(!W||ee.current==null||!Z||!ne)return;const{onDragOver:Q}=se.current,fe=we.get($t),Te=fe&&fe.rect.current?{id:fe.id,rect:fe.rect.current,data:fe.data,disabled:fe.disabled}:null,U={active:W,activatorEvent:Z,collisions:J,delta:{x:ne.x,y:ne.y},over:Te};_e.unstable_batchedUpdates(()=>{Bt(Te),Q?.(U),E({type:"onDragOver",event:U})})},[$t]),he(()=>{te.current={activatorEvent:H,active:V,activeNode:K,collisionRect:Pe,collisions:Xe,droppableRects:oe,draggableNodes:C,draggingNode:me,draggingNodeRect:be,droppableContainers:P,over:ye,scrollableAncestors:p,scrollAdjustedTranslate:Oe},B.current={initial:be,translated:Pe}},[V,K,Xe,Pe,C,me,be,oe,P,ye,p,Oe]),Yr({...ue,delta:O,draggingRect:Pe,pointerCoordinates:T,scrollableAncestors:p,scrollableAncestorRects:x});const zn=l.useMemo(()=>({active:V,activeNode:K,activeNodeRect:M,activatorEvent:H,collisions:Xe,containerNodeRect:ke,dragOverlay:ie,draggableNodes:C,droppableContainers:P,droppableRects:oe,over:ye,measureDroppableContainers:pe,scrollableAncestors:p,scrollableAncestorRects:x,measuringConfiguration:X,measuringScheduled:Ee,windowRect:h}),[V,K,M,H,Xe,ke,ie,C,P,oe,ye,pe,p,x,X,Ee,h]),On=l.useMemo(()=>({activatorEvent:H,activators:Xt,active:V,activeNodeRect:M,ariaDescribedById:{draggable:Re},dispatch:D,draggableNodes:C,over:ye,measureDroppableContainers:pe}),[H,Xt,V,M,D,Re,C,ye,pe]);return _.createElement(cn.Provider,{value:j},_.createElement(mt.Provider,{value:On},_.createElement(Sn.Provider,{value:zn},_.createElement(Nn.Provider,{value:An},u)),_.createElement(hs,{disabled:c?.restoreFocus===!1})),_.createElement(pr,{...c,hiddenTextDescribedById:Re}));function Pn(){const W=Ce?.autoScrollEnabled===!1,Z=typeof d=="object"?d.enabled===!1:d===!1,J=y&&!W&&!Z;return typeof d=="object"?{...d,enabled:J}:{enabled:J}}}),xs=l.createContext(null),sn="button",ys="Draggable";function ws(e){let{id:t,data:n,disabled:r=!1,attributes:s}=e;const o=nt(ys),{activators:a,activatorEvent:c,active:d,activeNodeRect:u,ariaDescribedById:g,draggableNodes:f,over:m}=l.useContext(mt),{role:b=sn,roleDescription:N="draggable",tabIndex:v=0}=s??{},w=d?.id===t,D=l.useContext(w?Nn:xs),[E,j]=ct(),[k,I]=ct(),y=ss(a,t),S=Ve(n);he(()=>(f.set(t,{id:t,key:o,node:E,activatorNode:k,data:S}),()=>{const O=f.get(t);O&&O.key===o&&f.delete(t)}),[f,t]);const C=l.useMemo(()=>({role:b,tabIndex:v,"aria-disabled":r,"aria-pressed":w&&b===sn?!0:void 0,"aria-roledescription":N,"aria-describedby":g.draggable}),[r,b,v,w,N,g.draggable]);return{active:d,activatorEvent:c,activeNodeRect:u,attributes:C,isDragging:w,listeners:r?void 0:y,node:E,over:m,setNodeRef:j,setActivatorNodeRef:I,transform:D}}function Ds(){return l.useContext(Sn)}const Ss="Droppable",Ns={timeout:25};function Cs(e){let{data:t,disabled:n=!1,id:r,resizeObserverConfig:s}=e;const o=nt(Ss),{active:a,dispatch:c,over:d,measureDroppableContainers:u}=l.useContext(mt),g=l.useRef({disabled:n}),f=l.useRef(!1),m=l.useRef(null),b=l.useRef(null),{disabled:N,updateMeasurementsFor:v,timeout:w}={...Ns,...s},D=Ve(v??r),E=l.useCallback(()=>{if(!f.current){f.current=!0;return}b.current!=null&&clearTimeout(b.current),b.current=setTimeout(()=>{u(Array.isArray(D.current)?D.current:[D.current]),b.current=null},w)},[w]),j=pt({callback:E,disabled:N||!a}),k=l.useCallback((C,O)=>{j&&(O&&(j.unobserve(O),f.current=!1),C&&j.observe(C))},[j]),[I,y]=ct(k),S=Ve(t);return l.useEffect(()=>{!j||!I.current||(j.disconnect(),f.current=!1,j.observe(I.current))},[I,j]),l.useEffect(()=>(c({type:F.RegisterDroppable,element:{id:r,key:o,disabled:n,node:I,rect:m,data:S}}),()=>c({type:F.UnregisterDroppable,key:o,id:r})),[r]),l.useEffect(()=>{n!==g.current.disabled&&(c({type:F.SetDroppableDisabled,id:r,key:o,disabled:n}),g.current.disabled=n)},[r,o,n,c]),{active:a,rect:m,isOver:d?.id===r,node:I,over:d,setNodeRef:y}}function Ft(e,t,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function js(e,t){return e.reduce((n,r,s)=>{const o=t.get(r);return o&&(n[s]=o),n},Array(e.length))}function at(e){return e!==null&&e>=0}function Rs(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Es(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const Cn=e=>{let{rects:t,activeIndex:n,overIndex:r,index:s}=e;const o=Ft(t,r,n),a=t[s],c=o[s];return!c||!a?null:{x:c.left-a.left,y:c.top-a.top,scaleX:c.width/a.width,scaleY:c.height/a.height}},it={scaleX:1,scaleY:1},ks=e=>{var t;let{activeIndex:n,activeNodeRect:r,index:s,rects:o,overIndex:a}=e;const c=(t=o[n])!=null?t:r;if(!c)return null;if(s===n){const u=o[a];return u?{x:0,y:n<a?u.top+u.height-(c.top+c.height):u.top-c.top,...it}:null}const d=Is(o,s,n);return s>n&&s<=a?{x:0,y:-c.height-d,...it}:s<n&&s>=a?{x:0,y:c.height+d,...it}:{x:0,y:0,...it}};function Is(e,t,n){const r=e[t],s=e[t-1],o=e[t+1];return r?n<t?s?r.top-(s.top+s.height):o?o.top-(r.top+r.height):0:o?o.top-(r.top+r.height):s?r.top-(s.top+s.height):0:0}const jn="Sortable",Rn=_.createContext({activeIndex:-1,containerId:jn,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Cn,disabled:{draggable:!1,droppable:!1}});function As(e){let{children:t,id:n,items:r,strategy:s=Cn,disabled:o=!1}=e;const{active:a,dragOverlay:c,droppableRects:d,over:u,measureDroppableContainers:g}=Ds(),f=nt(jn,n),m=c.rect!==null,b=l.useMemo(()=>r.map(y=>typeof y=="object"&&"id"in y?y.id:y),[r]),N=a!=null,v=a?b.indexOf(a.id):-1,w=u?b.indexOf(u.id):-1,D=l.useRef(b),E=!Rs(b,D.current),j=w!==-1&&v===-1||E,k=Es(o);he(()=>{E&&N&&g(b)},[E,b,N,g]),l.useEffect(()=>{D.current=b},[b]);const I=l.useMemo(()=>({activeIndex:v,containerId:f,disabled:k,disableTransforms:j,items:b,overIndex:w,useDragOverlay:m,sortedRects:js(b,d),strategy:s}),[v,f,k.draggable,k.droppable,j,b,w,d,m,s]);return _.createElement(Rn.Provider,{value:I},t)}const Ms=e=>{let{id:t,items:n,activeIndex:r,overIndex:s}=e;return Ft(n,r,s).indexOf(t)},zs=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:s,items:o,newIndex:a,previousItems:c,previousContainerId:d,transition:u}=e;return!u||!r||c!==o&&s===a?!1:n?!0:a!==s&&t===d},Os={duration:200,easing:"ease"},En="transform",Ps=Je.Transition.toString({property:En,duration:0,easing:"linear"}),Ts={roleDescription:"sortable"};function Ls(e){let{disabled:t,index:n,node:r,rect:s}=e;const[o,a]=l.useState(null),c=l.useRef(n);return he(()=>{if(!t&&n!==c.current&&r.current){const d=s.current;if(d){const u=Ue(r.current,{ignoreTransform:!0}),g={x:d.left-u.left,y:d.top-u.top,scaleX:d.width/u.width,scaleY:d.height/u.height};(g.x||g.y)&&a(g)}}n!==c.current&&(c.current=n)},[t,n,r,s]),l.useEffect(()=>{o&&a(null)},[o]),o}function Fs(e){let{animateLayoutChanges:t=zs,attributes:n,disabled:r,data:s,getNewIndex:o=Ms,id:a,strategy:c,resizeObserverConfig:d,transition:u=Os}=e;const{items:g,containerId:f,activeIndex:m,disabled:b,disableTransforms:N,sortedRects:v,overIndex:w,useDragOverlay:D,strategy:E}=l.useContext(Rn),j=$s(r,b),k=g.indexOf(a),I=l.useMemo(()=>({sortable:{containerId:f,index:k,items:g},...s}),[f,s,k,g]),y=l.useMemo(()=>g.slice(g.indexOf(a)),[g,a]),{rect:S,node:C,isOver:O,setNodeRef:P}=Cs({id:a,data:I,disabled:j.droppable,resizeObserverConfig:{updateMeasurementsFor:y,...d}}),{active:z,activatorEvent:B,activeNodeRect:V,attributes:ee,setNodeRef:Ce,listeners:je,isDragging:H,over:Ae,setActivatorNodeRef:se,transform:Re}=ws({id:a,data:I,attributes:{...Ts,...n},disabled:j.draggable}),Me=nr(P,Ce),X=!!z,oe=X&&!N&&at(m)&&at(w),pe=!D&&H,Ee=pe&&oe?Re:null,ze=oe?Ee??(c??E)({rects:v,activeNodeRect:V,activeIndex:m,overIndex:w,index:k}):null,ue=at(m)&&at(w)?o({id:a,items:g,activeIndex:m,overIndex:w}):k,ae=z?.id,M=l.useRef({activeId:ae,items:g,newIndex:ue,containerId:f}),ke=g!==M.current.items,te=t({active:z,containerId:f,isDragging:H,isSorting:X,id:a,index:k,items:g,newIndex:M.current.newIndex,previousItems:M.current.items,previousContainerId:M.current.containerId,transition:u,wasDragging:M.current.activeId!=null}),xe=Ls({disabled:!te,index:k,node:C,rect:S});return l.useEffect(()=>{X&&M.current.newIndex!==ue&&(M.current.newIndex=ue),f!==M.current.containerId&&(M.current.containerId=f),g!==M.current.items&&(M.current.items=g)},[X,ue,f,g]),l.useEffect(()=>{if(ae===M.current.activeId)return;if(ae!=null&&M.current.activeId==null){M.current.activeId=ae;return}const me=setTimeout(()=>{M.current.activeId=ae},50);return()=>clearTimeout(me)},[ae]),{active:z,activeIndex:m,attributes:ee,data:I,rect:S,index:k,newIndex:ue,items:g,isOver:O,isSorting:X,isDragging:H,listeners:je,node:C,overIndex:w,over:Ae,setNodeRef:Me,setActivatorNodeRef:se,setDroppableNodeRef:P,setDraggableNodeRef:Ce,transform:xe??ze,transition:ie()};function ie(){if(xe||ke&&M.current.newIndex===k)return Ps;if(!(pe&&!zt(B)||!u)&&(X||te))return Je.Transition.toString({...u,property:En})}}function $s(e,t){var n,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e?.draggable)!=null?n:t.draggable,droppable:(r=e?.droppable)!=null?r:t.droppable}}function ft(e){if(!e)return!1;const t=e.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const Bs=[A.Down,A.Right,A.Up,A.Left],Us=(e,t)=>{let{context:{active:n,collisionRect:r,droppableRects:s,droppableContainers:o,over:a,scrollableAncestors:c}}=t;if(Bs.includes(e.code)){if(e.preventDefault(),!n||!r)return;const d=[];o.getEnabled().forEach(f=>{if(!f||f!=null&&f.disabled)return;const m=s.get(f.id);if(m)switch(e.code){case A.Down:r.top<m.top&&d.push(f);break;case A.Up:r.top>m.top&&d.push(f);break;case A.Left:r.left>m.left&&d.push(f);break;case A.Right:r.left<m.left&&d.push(f);break}});const u=xr({collisionRect:r,droppableRects:s,droppableContainers:d});let g=fn(u,"id");if(g===a?.id&&u.length>1&&(g=u[1].id),g!=null){const f=o.get(n.id),m=o.get(g),b=m?s.get(m.id):null,N=m?.node.current;if(N&&b&&f&&m){const w=ht(N).some((y,S)=>c[S]!==y),D=kn(f,m),E=Xs(f,m),j=w||!D?{x:0,y:0}:{x:E?r.width-b.width:0,y:E?r.height-b.height:0},k={x:b.left,y:b.top};return j.x&&j.y?k:Ze(k,j)}}}};function kn(e,t){return!ft(e)||!ft(t)?!1:e.data.current.sortable.containerId===t.data.current.sortable.containerId}function Xs(e,t){return!ft(e)||!ft(t)||!kn(e,t)?!1:e.data.current.sortable.index<t.data.current.sortable.index}const Ws=({file:e,onDeletePages:t,onRotatePages:n,onReorderPages:r,onHighlightPages:s})=>{const{t:o}=kt(),[a,c]=l.useState(null),[d,u]=l.useState(!1),[g,f]=l.useState(null),[m,b]=l.useState(!0),[N,v]=l.useState("actions");l.useEffect(()=>{if(!e||!m){c(null);return}const S=setTimeout(async()=>{u(!0),f(null);try{const C=await Ht.analyzeDocument(e);c(C)}catch(C){console.error("Analysis failed:",C),f("Failed to analyze document")}finally{u(!1)}},300);return()=>clearTimeout(S)},[e,m]);const w=y=>{switch(y.type){case"remove_blank":case"remove_duplicates":t(y.affectedPages);break;case"fix_rotation":a&&y.affectedPages.forEach(S=>{const C=a.pages.find(O=>O.pageNumber===S);C&&C.suggestedRotation!==0&&n([S],C.suggestedRotation)});break;case"move_toc":if(r&&a){const S=a.coverPage,C=Array.from({length:a.totalPages},(P,z)=>z+1).filter(P=>!y.affectedPages.includes(P)&&P!==S),O=S?[S,...y.affectedPages,...C.filter(P=>P!==S)]:[...y.affectedPages,...C];r(O)}break}},D=y=>{s?.(y)},E=()=>i.jsx("button",{onClick:()=>b(!m),className:`relative inline-flex h-5 w-9 items-center rounded-full transition-colors ${m?"bg-ocean-500":"bg-gray-300 dark:bg-gray-600"}`,"aria-label":m?"Disable Smart Organize":"Enable Smart Organize",children:i.jsx("span",{className:`inline-block h-3.5 w-3.5 transform rounded-full bg-white transition-transform ${m?"translate-x-5":"translate-x-1"}`})});if(!e)return null;if(!m)return i.jsx(Le,{className:"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:i.jsx(ot,{className:"p-3",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2 opacity-60",children:[i.jsx("span",{className:"text-base",children:"ðŸ§ "}),i.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:o("smartOrganize.title")||"Smart Organize"}),i.jsx(Ie,{variant:"secondary",className:"text-[10px] bg-gray-400 text-white",children:"AI"})]}),i.jsx(E,{})]})})});if(d)return i.jsx(Le,{className:"border-ocean-400/50 dark:border-ocean-500/30 bg-white dark:bg-gray-800/90",children:i.jsx(ot,{className:"p-4",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-ocean-500 border-t-transparent rounded-full"}),i.jsx("span",{className:"text-sm text-ocean-700 dark:text-ocean-300",children:o("smartOrganize.analyzing")||"Analyzing pages..."})]}),i.jsx(E,{})]})})});if(g)return i.jsx(Le,{className:"border-amber-200 dark:border-amber-800 bg-amber-50/50 dark:bg-amber-950/30",children:i.jsx(ot,{className:"p-4",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("p",{className:"text-sm text-amber-700 dark:text-amber-300",children:g}),i.jsx(E,{})]})})});if(!a)return null;const j=Ht.generateActions(a,o),k=a.issuesCount>0,I=a.chapters.length>0;return i.jsx(Le,{className:"border-ocean-400/50 dark:border-ocean-500/30 bg-white dark:bg-gray-800/90 shadow-sm",children:i.jsxs(ot,{className:"p-4 space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-lg",children:"ðŸ§ "}),i.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:o("smartOrganize.title")||"Smart Organize"}),i.jsx(Ie,{variant:"secondary",className:"text-xs bg-ocean-500 text-white",children:"AI"}),i.jsxs("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:[Math.round(a.analysisTime),"ms"]})]}),i.jsx(E,{})]}),i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsxs(Ie,{className:"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300",children:[a.totalPages," pages"]}),a.blankPages.length>0&&i.jsxs(Ie,{className:"bg-amber-100 dark:bg-amber-900/50 text-amber-700 dark:text-amber-300 cursor-pointer hover:bg-amber-200 dark:hover:bg-amber-900",onClick:()=>D(a.blankPages),children:[a.blankPages.length," blank"]}),a.duplicateGroups.length>0&&i.jsxs(Ie,{className:"bg-orange-100 dark:bg-orange-900/50 text-orange-700 dark:text-orange-300 cursor-pointer hover:bg-orange-200 dark:hover:bg-orange-900",onClick:()=>D(a.duplicateGroups.flatMap(y=>y.pages)),children:[a.duplicateGroups.reduce((y,S)=>y+S.pages.length-1,0)," duplicates"]}),a.rotationNeeded.length>0&&i.jsxs(Ie,{className:"bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300 cursor-pointer hover:bg-blue-200 dark:hover:bg-blue-900",onClick:()=>D(a.rotationNeeded),children:[a.rotationNeeded.length," rotated"]}),I&&i.jsxs(Ie,{className:"bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300",children:[a.chapters.length," chapters"]})]}),j.length>0&&i.jsxs("div",{className:"space-y-2",children:[i.jsxs("button",{onClick:()=>v(N==="actions"?null:"actions"),className:"flex items-center justify-between w-full text-left py-1",children:[i.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:o("smartOrganize.quickActions")||"Quick Actions"}),i.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:N==="actions"?"â–¼":"â–¶"})]}),N==="actions"&&i.jsx("div",{className:"grid grid-cols-1 gap-2",children:j.map((y,S)=>i.jsx(q,{variant:"outline",size:"sm",onClick:()=>w(y),className:"justify-start h-auto py-3 px-4 bg-gray-50 dark:bg-gray-700/50 border-gray-200 dark:border-gray-600 hover:bg-ocean-50 dark:hover:bg-ocean-900/30 hover:border-ocean-400 dark:hover:border-ocean-500 transition-colors",children:i.jsxs("div",{className:"flex items-center gap-3 w-full",children:[i.jsx("span",{className:"text-xl",children:y.icon}),i.jsxs("div",{className:"flex-1 text-left",children:[i.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:y.label}),i.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:y.description})]})]})},S))})]}),I&&i.jsxs("div",{className:"space-y-2",children:[i.jsxs("button",{onClick:()=>v(N==="chapters"?null:"chapters"),className:"flex items-center justify-between w-full text-left py-1",children:[i.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:o("smartOrganize.detectedChapters")||"Detected Chapters"}),i.jsx("span",{className:"text-gray-400 dark:text-gray-500",children:N==="chapters"?"â–¼":"â–¶"})]}),N==="chapters"&&i.jsx("div",{className:"space-y-1 max-h-60 overflow-y-auto pr-1 scrollbar-thin scrollbar-thumb-gray-200 dark:scrollbar-thumb-gray-700",children:a.chapters.map((y,S)=>i.jsxs("div",{onClick:()=>D([y.startPage]),className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700/50 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-sm text-gray-400",children:"ðŸ“–"}),i.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-200 truncate max-w-[150px]",children:y.title})]}),i.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap",children:["p. ",y.startPage,y.endPage&&` - ${y.endPage}`]})]},S))})]}),!k&&j.length===0&&i.jsx("div",{className:"text-center py-2",children:i.jsxs("span",{className:"text-green-600 dark:text-green-400 text-sm",children:["âœ“ ",o("smartOrganize.noIssues")||"No issues detected - document looks good!"]})})]})})},Hs=({page:e,isSelected:t,onToggleSelection:n,onRotate:r,onDelete:s,onRestore:o,onZoom:a})=>{const{t:c}=kt(),{attributes:d,listeners:u,setNodeRef:g,transform:f,transition:m,isDragging:b}=Fs({id:e.id,disabled:e.isDeleted}),N={transform:Je.Transform.toString(f),transition:m,opacity:b?.5:e.isDeleted?.4:1};return i.jsx("div",{ref:g,style:N,className:`relative group ${e.isDeleted?"grayscale":""}`,children:i.jsxs(Le,{className:`p-2 hover:shadow-lg transition-all bg-white dark:bg-gray-800 border-2 ${t?"border-ocean-500 shadow-md ring-1 ring-ocean-500/20":"border-transparent hover:border-gray-200 dark:hover:border-gray-700"}`,onClick:v=>{(v.target===v.currentTarget||v.target.closest(".thumbnail-container"))&&n(e.id)},children:[!e.isDeleted&&i.jsx("div",{className:"absolute top-3 left-3 z-10",children:i.jsx(_n,{checked:t,onCheckedChange:()=>n(e.id),className:`bg-white/90 backdrop-blur-sm data-[state=checked]:bg-ocean-500 border-gray-300 dark:border-gray-600 ${t?"opacity-100":"opacity-0 group-hover:opacity-100 transition-opacity"}`})}),i.jsx("div",{...d,...u,className:`cursor-move mb-2 text-center text-xs font-medium text-gray-500 dark:text-gray-400 ${e.isDeleted?"cursor-not-allowed":""}`,children:e.pageNumber}),i.jsxs("div",{className:"thumbnail-container relative aspect-[1/1.4] bg-gray-100 dark:bg-gray-900 rounded overflow-hidden flex items-center justify-center group/image cursor-pointer",onClick:()=>!e.isDeleted&&n(e.id),children:[e.dataUrl?i.jsxs(i.Fragment,{children:[i.jsx("img",{src:e.dataUrl,alt:`Page ${e.pageNumber}`,className:"w-full h-full object-contain select-none",style:{transform:`rotate(${e.rotation}deg)`,transition:"transform 0.3s ease"}}),!e.isDeleted&&i.jsx("button",{onClick:v=>{v.stopPropagation(),a(e.pageNumber)},className:"absolute top-2 right-2 p-1.5 bg-black/50 hover:bg-black/70 rounded-full text-white opacity-0 group-hover/image:opacity-100 transition-opacity",title:c("common.zoom"),children:i.jsx(Qn,{className:"w-4 h-4"})})]}):i.jsx("div",{className:"animate-pulse bg-gray-200 dark:bg-gray-800 w-full h-full"}),e.isDeleted&&i.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 backdrop-blur-[1px]",children:i.jsx("span",{className:"text-white text-xs font-bold uppercase tracking-wider",children:c("pageEditor.deleted")})})]}),i.jsx("div",{className:"flex gap-1 mt-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.isDeleted?i.jsxs(q,{size:"sm",variant:"outline",onClick:v=>{v.stopPropagation(),o(e.id)},className:"flex-1 h-7 text-xs text-green-600 hover:text-green-700 hover:bg-green-50 dark:hover:bg-green-900/20",title:c("pageEditor.restorePage"),children:[i.jsx(tr,{className:"w-3 h-3 mr-1"}),c("pageEditor.restore")]}):i.jsxs(i.Fragment,{children:[i.jsx(q,{size:"sm",variant:"outline",onClick:v=>{v.stopPropagation(),r(e.id)},className:"flex-1 h-7 text-xs px-0",title:c("pageEditor.rotate90"),children:i.jsx(Hn,{className:"w-3 h-3"})}),i.jsx(q,{size:"sm",variant:"outline",onClick:v=>{v.stopPropagation(),s(e.id)},className:"flex-1 h-7 text-xs px-0 text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",title:c("pageEditor.deletePage"),children:i.jsx(on,{className:"w-3 h-3"})})]})})]})})},uo=()=>{const{t:e}=kt(),{status:t}=Ln(),n=t==="pro"||t==="lifetime",{sharedFile:r,clearSharedFile:s,setSharedFile:o}=Fn(),[a,c]=l.useState(null),[d,u]=l.useState([]),[g,f]=l.useState(new Set),[m,b]=l.useState(!1),[,N]=l.useState(0),[v,w]=l.useState(""),[D,E]=l.useState(null),[j,k]=l.useState(!1),I=_.useRef(null),[y,S]=l.useState(null),[C,O]=l.useState(null),[P,z]=l.useState(!1),{thumbnails:B,isLoading:V}=Kn({file:a?.file,thumbnailWidth:300,thumbnailHeight:400,onProgress:(h,p)=>{const x=Math.round(h/p*100);N(x),w(`${e("common.generatingThumbnails")} ${x}%`)}});l.useEffect(()=>{if(B.length>0)if(d.length===0){const h=B.map(p=>({...p,id:`page-${p.pageNumber}`,rotation:0,isDeleted:!1}));u(h)}else u(h=>h.map(p=>{const x=B.find(R=>R.pageNumber===p.pageNumber);return x?{...p,dataUrl:x.dataUrl}:p}))},[B]),l.useEffect(()=>{(async()=>{if(y!==null&&a?.file){z(!0),O(null);try{const p=await ce.renderPageAsImage(a.file,y,2.5);O(p)}catch(p){console.error("Failed to load zoomed image",p),Y.error(e("common.error"))}finally{z(!1)}}else O(null)})()},[y,a,e]),l.useEffect(()=>{if(r&&!a&&!D){const h=new File([r.blob],r.name,{type:"application/pdf"});je([h]),s()}},[r,a,D,s]),l.useEffect(()=>{if(D?.blob&&!m&&!j){const h=a?.name.replace(/\.pdf$/i,"_organized.pdf")||"organized.pdf";o(D.blob,h,"organize-pdf"),k(!0)}},[D,m,j,a?.name,o]);const ee=mr(_t(Lt,{activationConstraint:{distance:5}}),_t(Pt,{coordinateGetter:Us})),Ce=h=>{const{active:p,over:x}=h;x&&p.id!==x.id&&u(R=>{const T=R.findIndex(le=>le.id===p.id),L=R.findIndex(le=>le.id===x.id);return Ft(R,T,L)})},je=async h=>{if(h.length===0)return;const p=h[0],x={id:`${Date.now()}`,file:p,name:p.name,size:p.size,status:"pending"};c(x),E(null),k(!1),u([]),f(new Set),N(0);try{const R=await ce.getPDFInfo(p);c(T=>T?{...T,info:R,status:"completed"}:null)}catch{c(R=>R?{...R,status:"error",error:e("pageEditor.failedRead")}:null),Y.error(e("pageEditor.failedRead"))}},H=h=>{f(p=>{const x=new Set(p);return x.has(h)?x.delete(h):x.add(h),x})},Ae=()=>{g.size===d.length?f(new Set):f(new Set(d.map(h=>h.id)))},se=()=>{const h=d.filter(p=>p.pageNumber%2!==0).map(p=>p.id);f(new Set(h))},Re=()=>{const h=d.filter(p=>p.pageNumber%2===0).map(p=>p.id);f(new Set(h))},Me=h=>{u(p=>p.map(x=>x.id===h?{...x,rotation:(x.rotation+90)%360}:x))},X=h=>{u(p=>p.map(x=>x.id===h?{...x,isDeleted:!0}:x)),f(p=>{const x=new Set(p);return x.delete(h),x})},oe=h=>{u(p=>p.map(x=>x.id===h?{...x,isDeleted:!1}:x))},pe=h=>{u(p=>p.map(x=>h.includes(x.pageNumber)?{...x,isDeleted:!0}:x)),Y.success(`${h.length} page(s) marked for deletion`)},Ee=(h,p)=>{u(x=>x.map(R=>h.includes(R.pageNumber)?{...R,rotation:(R.rotation+p)%360}:R)),Y.success(`${h.length} page(s) rotated`)},K=()=>{u(h=>h.map(p=>g.has(p.id)?{...p,isDeleted:!0}:p)),f(new Set),Y.success(`${g.size} ${e("pageEditor.pagesDeleted")||"pages deleted"}`)},ze=async h=>{if(!(!a?.file||g.size===0)){b(!0),N(0),w(e("pageEditor.extracting")||"Extracting pages...");try{const p=d.filter(R=>g.has(R.id)).map(R=>R.pageNumber).sort((R,T)=>R-T),x=await ce.splitPDF(a.file,"custom",{pages:p},(R,T)=>{N(R),w(T)});if(x.success&&x.data&&x.data[0]){let R=x.data[0];if(!n&&h)try{const L=await R.arrayBuffer(),le=await ce.applyWatermark(new Uint8Array(L));R=new Blob([new Uint8Array(le)],{type:"application/pdf"})}catch(L){console.error("Failed to apply watermark:",L)}const T=a.name.replace(/\.pdf$/i,"_extracted.pdf");ce.downloadFile(R,T),Y.success(e("pageEditor.extractSuccess")||"Pages extracted successfully")}else Y.error(e("pageEditor.extractError")||"Failed to extract pages")}catch(p){console.error("Error extracting pages:",p),Y.error(e("pageEditor.extractError")||"Failed to extract pages")}finally{b(!1),N(0),w("")}}},ue=h=>ze(h),ae=h=>{u(p=>{const x=new Map(p.map(L=>[L.pageNumber,L])),R=h.map(L=>x.get(L)).filter(L=>L!==void 0),T=p.filter(L=>!h.includes(L.pageNumber));return[...R,...T]}),Y.success("Pages reordered")},M=h=>{const p=new Set;d.forEach(x=>{h.includes(x.pageNumber)&&p.add(x.id)}),f(p),Y.info(`Selected ${h.length} pages`)},ke=async h=>{const p=h.target.files?.[0];if(p){b(!0),N(0),w("Processing new file...");try{const R=(await ce.getPDFInfo(p)).pages,L=(await ce.getPreviews(p,.5)).map((le,bt)=>({id:crypto.randomUUID(),pageNumber:bt+1,dataUrl:le,rotation:0,isDeleted:!1,width:0,height:0,sourceFile:p}));u(le=>[...le,...L]),Y.success(`Appended ${R} pages`)}catch(x){console.error("Error inserting file:",x),Y.error("Failed to insert file")}finally{b(!1),N(0),w(""),I.current&&(I.current.value="")}}},te=async()=>{if(!a?.file)return;const h=d.filter(p=>!p.isDeleted);if(h.length===0){Y.error(e("pageEditor.noPages"));return}b(!0),N(0),w("Processing pages...");try{const p=h.map((R,T)=>({originalPageNumber:R.pageNumber,newPosition:T+1,rotation:R.rotation})),x=await ce.organizePDF(a.file,p,(R,T)=>{N(R),w(T)});x.success&&x.data?E({blob:x.data,metadata:x.metadata||{pageCount:h.length}}):Y.error(x.error?.message||e("pageEditor.failedOrganize"))}catch(p){console.error("Error organizing PDF:",p),Y.error(e("pageEditor.errorOrganize"))}finally{b(!1),N(0),w("")}},xe=async h=>{if(D?.blob){let p=D.blob;if(!n&&h)try{const R=await D.blob.arrayBuffer(),T=await ce.applyWatermark(new Uint8Array(R));p=new Blob([new Uint8Array(T)],{type:"application/pdf"})}catch(R){console.error("Failed to apply watermark:",R)}const x=a?.name.replace(/\.pdf$/i,"_organized.pdf")||"organized.pdf";ce.downloadFile(p,x)}},ie=()=>{c(null),E(null),u([]),f(new Set),N(0),w(""),k(!1)},me=h=>{D?.blob&&o(D.blob,"organized.pdf","organize-pdf"),window.location.hash=Wn[h]},be=d.length>0&&(d.some(h=>h.rotation!==0||h.isDeleted)||d.map(h=>h.pageNumber).join(",")!==B.map(h=>h.pageNumber).join(",")),rt=()=>a?V&&d.length===0?i.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px]",children:[i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-ocean-500 mb-4"}),i.jsx("p",{className:"text-gray-500",children:v||e("common.generatingThumbnails")})]}):D?i.jsxs("div",{className:"text-center space-y-6 max-w-2xl mx-auto pt-8",children:[i.jsx("div",{className:"w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto text-green-600",children:i.jsx(Bn,{className:"w-10 h-10"})}),i.jsx("h2",{className:"text-2xl font-bold",children:e("pageEditor.successOrganized")}),i.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-6 max-w-md mx-auto",children:[i.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[i.jsx("span",{className:"text-gray-500",children:e("common.originalSize")}),i.jsx("span",{className:"font-medium",children:ce.formatFileSize(a.size)})]}),i.jsxs("div",{className:"flex justify-between text-sm",children:[i.jsx("span",{className:"text-gray-500",children:e("common.pages")}),i.jsx("span",{className:"font-medium",children:D.metadata?.pageCount||d.filter(h=>!h.isDeleted).length})]})]}),i.jsxs("div",{className:"flex justify-center gap-4",children:[i.jsx(Wt,{toolId:"organize-pdf",onDownload:xe,showWatermarkLabel:!n}),i.jsxs(q,{onClick:ie,variant:"outline",className:"h-11 px-8 rounded-xl font-bold border-2",children:[i.jsx(qn,{className:"mr-2 h-4 w-4"}),e("common.processAnother")]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-8",children:[i.jsxs(q,{onClick:()=>me("compress-pdf"),variant:"ghost",className:"h-auto py-3 flex flex-col gap-1 border hover:border-ocean-300 hover:bg-ocean-50 dark:hover:bg-ocean-900/10",children:[i.jsx(Un,{className:"h-5 w-5 text-ocean-500"}),i.jsx("span",{className:"text-sm font-medium",children:e("tools.compress-pdf.name")})]}),i.jsxs(q,{onClick:()=>me("protect-pdf"),variant:"ghost",className:"h-auto py-3 flex flex-col gap-1 border hover:border-ocean-300 hover:bg-ocean-50 dark:hover:bg-ocean-900/10",children:[i.jsx(Xn,{className:"h-5 w-5 text-ocean-500"}),i.jsx("span",{className:"text-sm font-medium",children:e("tools.protect-pdf.name")})]})]})]}):i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex flex-wrap items-center justify-between text-sm text-gray-500 bg-white dark:bg-gray-800 p-2 rounded-lg border border-gray-100 dark:border-gray-700 sticky top-0 z-10 shadow-sm min-h-[52px]",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs(q,{variant:"ghost",size:"sm",onClick:Ae,className:"h-8 gap-2",children:[g.size===d.length&&d.length>0?i.jsx(Gn,{className:"w-4 h-4"}):i.jsx(Vn,{className:"w-4 h-4"}),e("common.selectAll")||"Select All"]}),i.jsx("div",{className:"h-4 w-px bg-gray-200 dark:bg-gray-700 mx-1"}),i.jsxs("div",{className:"flex gap-1",children:[i.jsx(q,{variant:"ghost",size:"sm",onClick:se,className:"h-8 px-2 text-xs",children:e("pageEditor.odd")||"Odd"}),i.jsx(q,{variant:"ghost",size:"sm",onClick:Re,className:"h-8 px-2 text-xs",children:e("pageEditor.even")||"Even"})]}),g.size>0&&i.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-ocean-100 dark:bg-ocean-900/50 text-ocean-700 dark:text-ocean-300 rounded-full text-xs font-medium animate-in fade-in zoom-in",children:[g.size," selected"]})]}),i.jsxs("div",{className:"flex gap-2 items-center",children:[g.size>0&&i.jsxs(i.Fragment,{children:[i.jsx(Wt,{toolId:"organize-pdf",onDownload:ue,className:"h-8",showWatermarkLabel:!n,children:i.jsxs(q,{size:"sm",className:"h-8 px-3 gap-2 bg-ocean-500 hover:bg-ocean-600 text-white shadow-sm",children:[i.jsx(Zn,{className:"w-4 h-4"}),e("pageEditor.extract")||"Extract"]})}),i.jsxs(q,{size:"sm",variant:"destructive",onClick:K,className:"h-8 px-3 gap-2 shadow-sm animate-in fade-in slide-in-from-right-4",children:[i.jsx(on,{className:"w-4 h-4"}),e("pageEditor.delete")||"Delete"]}),i.jsx("div",{className:"h-4 w-px bg-gray-200 dark:bg-gray-700 mx-1"})]}),i.jsx(q,{variant:"ghost",size:"sm",onClick:()=>u(h=>h.map(p=>({...p,rotation:0,isDeleted:!1}))),disabled:!be,className:"h-8 px-3 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20",children:e("common.reset")})]})]}),i.jsx(vs,{sensors:ee,collisionDetection:vr,onDragEnd:Ce,children:i.jsx(As,{items:d.map(h=>h.id),strategy:ks,children:i.jsx("div",{className:"h-[calc(100vh-16rem)] min-h-[500px] overflow-y-auto pr-4 -mr-4 scrollbar-thin scrollbar-thumb-gray-200 dark:scrollbar-thumb-gray-700 p-1",children:i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 pb-2",children:[d.map(h=>i.jsx(Hs,{page:h,isSelected:g.has(h.id),onToggleSelection:H,onRotate:Me,onDelete:X,onRestore:oe,onZoom:S},h.id)),i.jsxs(Le,{className:"aspect-[3/4] flex flex-col items-center justify-center border-dashed border-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors group relative overflow-hidden",onClick:()=>I.current?.click(),children:[i.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center group-hover:scale-110 transition-transform mb-3 z-10",children:i.jsx(Jn,{className:"w-6 h-6 text-gray-500 group-hover:text-ocean-500 transition-colors"})}),i.jsx("span",{className:"text-sm font-medium text-gray-500 group-hover:text-ocean-500 transition-colors z-10",children:e("pageEditor.addPDF")}),i.jsx("span",{className:"text-xs text-gray-400 mt-1 z-10",children:e("pageEditor.appendPages")})]})]})})})}),i.jsx("input",{type:"file",ref:I,className:"hidden",accept:".pdf",onChange:ke})]}):null,st=()=>i.jsxs("div",{className:"space-y-6",children:[i.jsx(Ws,{file:a?.file||null,onDeletePages:pe,onRotatePages:Ee,onReorderPages:ae,onHighlightPages:M}),i.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-100 dark:border-gray-700",children:[i.jsx("h4",{className:"font-medium text-sm mb-2 text-gray-900 dark:text-gray-100",children:e("pageEditor.tips.title")}),i.jsxs("ul",{className:"text-xs text-gray-500 space-y-1 ml-4 list-disc",children:[i.jsx("li",{children:e("pageEditor.tips.drag")}),i.jsx("li",{children:e("pageEditor.tips.select")}),i.jsx("li",{children:e("pageEditor.tips.rotateDelete")}),i.jsx("li",{children:e("pageEditor.tips.extract")})]})]})]});return i.jsxs(i.Fragment,{children:[i.jsx(Yn,{title:e("tools.organize-pdf.name"),description:e("tools.organize-pdf.description"),hasFiles:!!a,onUpload:je,isProcessing:m,maxFiles:1,uploadTitle:e("common.selectFile"),uploadDescription:e("upload.singleFileAllowed"),acceptedTypes:".pdf",settings:!D&&a?st():null,actions:!D&&a?i.jsx(q,{onClick:te,disabled:m||!be,className:"w-full py-6 text-lg font-bold shadow-lg shadow-ocean-500/20",children:e(m?"common.processing":"pageEditor.downloadOrganized")}):null,children:rt()}),y!==null&&i.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-in fade-in duration-200",onClick:()=>S(null),children:i.jsxs("div",{className:"relative max-w-4xl max-h-[90vh] w-full h-full flex items-center justify-center",children:[i.jsx("button",{onClick:()=>S(null),className:"absolute -top-12 right-0 p-2 text-white hover:text-gray-300",children:i.jsx($n,{className:"w-8 h-8"})}),P?i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[i.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-white"}),i.jsx("p",{className:"text-white text-sm",children:e("common.loading")})]}):C?i.jsx("img",{src:C,alt:`Page ${y}`,className:"max-w-full max-h-full object-contain rounded shadow-2xl",onClick:h=>h.stopPropagation()}):null]})})]})};export{uo as PageEditorPDF};
