import{r as o,j as e,Q as re,u as q,a as f,L as p,k as N,J as se,b as ae,Z as ne,K as le,p as oe,o as ie}from"./index-ByNlfbxM.js";import{T as de}from"./ToolLayout-CEHQ6Lwh.js";import{g as ce,G as me}from"./vendor-pdfjs-BlOy0ZkI.js";import{C as H}from"./checkbox-D18Jwqrr.js";import{D as xe}from"./DownloadGate-DVCOsD5O.js";import{C as ue}from"./copy-C86R9Vj5.js";import"./vendor-react-CTjRfaZN.js";import"./vendor-pdf-lib-CZHCEpXA.js";import"./vendor-word-CeUssL8V.js";import"./vendor-ocr-CTFn7PEu.js";import"./FileUpload-vqoJmZZ0.js";import"./index-NZhszMUr.js";import"./download-BBtiLdGt.js";const he=({pdfDocument:t,currentPage:b,formFields:y,selectedFieldId:n,scale:l,onFieldSelect:r,onFieldMove:x,onFieldResize:_,onTotalPagesChange:i,isDocumentLoading:L})=>{const w=o.useRef(null),T=o.useRef(null),[P,U]=o.useState(!1),[C,$]=o.useState(null),[S,B]=o.useState(null),F=o.useRef(null),u=o.useRef(!1),z=o.useCallback(async()=>{if(!(!t||!w.current||u.current)){F.current&&(F.current.cancel(),F.current=null),u.current=!0,U(!0);try{const a=await t.getPage(b+1),h=a.getViewport({scale:l*1.5}),m=w.current;if(!m)return;const j=m.getContext("2d");if(!j)return;m.width=h.width,m.height=h.height,F.current=a.render({canvasContext:j,viewport:h,canvas:w.current}),await F.current.promise}catch(a){a instanceof Error&&a.name==="RenderingCancelledException"||console.error("Error rendering page:",a)}finally{F.current=null,u.current=!1,U(!1)}}},[t,b,l]);o.useEffect(()=>{const a=setTimeout(()=>{z()},50);return()=>{clearTimeout(a),F.current&&F.current.cancel()}},[z]),o.useEffect(()=>{t&&i(t.numPages)},[t,i]);const M=(a,h)=>{a.stopPropagation(),r(h);const m=y.find(Y=>Y.id===h);if(!m)return;const j=w.current?.getBoundingClientRect();if(!j)return;const g=(a.clientX-j.left)/(l*1.5),v=(a.clientY-j.top)/(l*1.5);g>=m.x+m.width-10&&g<=m.x+m.width&&v>=m.y+m.height-10&&v<=m.y+m.height?B({fieldId:h,startX:g,startY:v,startWidth:m.width,startHeight:m.height}):$({fieldId:h,startX:g,startY:v,offsetX:g-m.x,offsetY:v-m.y})},R=a=>{const h=w.current?.getBoundingClientRect();if(!h)return;const m=(a.clientX-h.left)/(l*1.5),j=(a.clientY-h.top)/(l*1.5);if(C){const g=Math.max(0,m-C.offsetX),v=Math.max(0,j-C.offsetY);x(C.fieldId,g,v)}else if(S){const g=m-S.startX,v=j-S.startY,D=Math.max(20,S.startWidth+g),Y=Math.max(15,S.startHeight+v);_(S.fieldId,D,Y)}},E=()=>{$(null),B(null)},X=a=>{a.target===w.current&&r(null)},O=y.filter(a=>a.page===b);return e.jsx("div",{ref:T,className:"relative flex items-center justify-center p-8 min-w-full min-h-full",onMouseMove:R,onMouseUp:E,onMouseLeave:E,children:e.jsxs("div",{className:"relative shadow-2xl",style:{cursor:C||S?"move":"default"},children:[e.jsx("canvas",{ref:w,className:"bg-white block",onClick:X}),(L||P||!t)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 dark:bg-black/50 backdrop-blur-sm z-50",children:e.jsx(re,{className:"w-8 h-8 animate-spin text-ocean-500"})}),!L&&t&&O.map(a=>e.jsxs("div",{className:`absolute border-2 ${n===a.id?"border-ocean-500 bg-ocean-100/30 dark:bg-ocean-500/20 z-10":"border-gray-400 bg-gray-200/30 dark:bg-gray-600/20 hover:border-ocean-400 z-0"} cursor-move`,style:{left:a.x*l*1.5,top:a.y*l*1.5,width:a.width*l*1.5,height:a.height*l*1.5},onMouseDown:h=>M(h,a.id),children:[e.jsx("div",{className:"absolute -top-6 left-0 text-[10px] bg-gray-800 text-white px-2 py-0.5 rounded whitespace-nowrap opacity-80 pointer-events-none",children:a.name}),e.jsxs("div",{className:"flex items-center justify-center h-full text-[10px] text-gray-600 dark:text-gray-300 font-mono pointer-events-none select-none",children:[a.type==="text"&&"ðŸ“ Text",a.type==="multiline"&&"ðŸ“„ Multi",a.type==="checkbox"&&"â˜‘ï¸",a.type==="radio"&&"ðŸ”˜",a.type==="dropdown"&&"â–¼"]}),n===a.id&&e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-ocean-500 cursor-se-resize",style:{marginBottom:-1,marginRight:-1}})]},a.id))]})})},pe=({currentPage:t,totalPages:b,scale:y,onPageChange:n,onScaleChange:l,onSave:r,onAddField:x,hideSave:_})=>{const{t:i}=q();return e.jsxs("div",{className:"flex items-center gap-4 px-4 py-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400 font-medium mr-1",children:i("addFormFields.toolbar.addField")}),e.jsxs(f,{onClick:()=>x("text"),variant:"outline",size:"sm",className:"text-xs",title:i("addFormFields.toolbar.addText"),children:["ðŸ“ ",i("addFormFields.types.text")]}),e.jsxs(f,{onClick:()=>x("multiline"),variant:"outline",size:"sm",className:"text-xs",title:i("addFormFields.toolbar.addMultiline"),children:["ðŸ“„ ",i("addFormFields.types.multiline")]}),e.jsxs(f,{onClick:()=>x("checkbox"),variant:"outline",size:"sm",className:"text-xs",title:i("addFormFields.toolbar.addCheckbox"),children:["â˜‘ï¸ ",i("addFormFields.types.checkbox")]}),e.jsxs(f,{onClick:()=>x("radio"),variant:"outline",size:"sm",className:"text-xs",title:i("addFormFields.toolbar.addRadio"),children:["ðŸ”˜ ",i("addFormFields.types.radio")]}),e.jsxs(f,{onClick:()=>x("dropdown"),variant:"outline",size:"sm",className:"text-xs",title:i("addFormFields.toolbar.addDropdown"),children:["â–¼ ",i("addFormFields.types.dropdown")]})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{onClick:()=>n(Math.max(0,t-1)),disabled:t===0,variant:"outline",size:"sm",className:"text-xs",children:"â†"}),e.jsxs("span",{className:"text-sm text-gray-700 dark:text-gray-300 min-w-[80px] text-center",children:[t+1," / ",b]}),e.jsx(f,{onClick:()=>n(Math.min(b-1,t+1)),disabled:t>=b-1,variant:"outline",size:"sm",className:"text-xs",children:"â†’"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{onClick:()=>l(Math.max(.25,y-.25)),disabled:y<=.25,variant:"outline",size:"sm",className:"text-xs",title:i("common.zoom"),children:"âˆ’"}),e.jsxs("span",{className:"text-sm text-gray-700 dark:text-gray-300 min-w-[60px] text-center",children:[Math.round(y*100),"%"]}),e.jsx(f,{onClick:()=>l(Math.min(3,y+.25)),disabled:y>=3,variant:"outline",size:"sm",className:"text-xs",title:i("common.zoom"),children:"+"})]}),!_&&e.jsx(f,{onClick:r,size:"sm",children:i("addFormFields.toolbar.savePdf")})]})},ge=({selectedField:t,onFieldUpdate:b,onFieldDelete:y})=>{const{t:n}=q();if(!t)return e.jsx("div",{className:"w-80 border-r border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900 p-6",children:e.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400 mt-20",children:[e.jsx("p",{className:"text-4xl mb-4",children:"ðŸ“"}),e.jsx("p",{className:"text-sm",children:n("addFormFields.panel.selectToEdit")})]})});const l=r=>{b(t.id,r)};return e.jsx("div",{className:"w-80 border-r border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900 p-4 overflow-y-auto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:n("addFormFields.panel.title")}),e.jsx(f,{onClick:()=>y(t.id),variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20",title:n("addFormFields.panel.deleteField"),children:"ðŸ—‘ï¸"})]}),e.jsx("div",{className:"inline-block px-3 py-1 bg-ocean-100 dark:bg-ocean-900 text-ocean-700 dark:text-ocean-300 rounded-full text-xs font-medium",children:n(`addFormFields.types.${t.type}`)}),e.jsxs("div",{children:[e.jsx(p,{children:n("addFormFields.panel.fieldName")}),e.jsx(N,{type:"text",value:t.name,onChange:r=>l({name:r.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(p,{children:n("addFormFields.panel.xPosition")}),e.jsx(N,{type:"number",value:Math.round(t.x),onChange:r=>l({x:Number(r.target.value)})})]}),e.jsxs("div",{children:[e.jsx(p,{children:n("addFormFields.panel.yPosition")}),e.jsx(N,{type:"number",value:Math.round(t.y),onChange:r=>l({y:Number(r.target.value)})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(p,{children:n("addFormFields.panel.width")}),e.jsx(N,{type:"number",value:Math.round(t.width),onChange:r=>l({width:Number(r.target.value)})})]}),e.jsxs("div",{children:[e.jsx(p,{children:n("addFormFields.panel.height")}),e.jsx(N,{type:"number",value:Math.round(t.height),onChange:r=>l({height:Number(r.target.value)})})]})]}),(t.type==="text"||t.type==="multiline")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(p,{children:n("addFormFields.panel.defaultValue")}),e.jsx(N,{type:"text",value:t.defaultValue||"",onChange:r=>l({defaultValue:r.target.value}),placeholder:n("addFormFields.panel.defaultPlaceholder")})]}),e.jsxs("div",{children:[e.jsx(p,{children:n("addFormFields.panel.maxLength")}),e.jsx(N,{type:"number",value:t.maxLength||"",onChange:r=>l({maxLength:r.target.value?Number(r.target.value):void 0}),placeholder:n("addFormFields.panel.maxLengthPlaceholder")})]}),e.jsxs("div",{children:[e.jsx(p,{children:n("addFormFields.panel.fontSize")}),e.jsx(N,{type:"number",value:t.fontSize||12,onChange:r=>l({fontSize:Number(r.target.value)}),min:"6",max:"72"})]})]}),t.type==="checkbox"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:"checkbox-checked",checked:t.checked||!1,onCheckedChange:r=>l({checked:r})}),e.jsx(p,{htmlFor:"checkbox-checked",className:"text-sm font-normal cursor-pointer",children:n("addFormFields.panel.checkedByDefault")})]}),t.type==="radio"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(p,{children:n("addFormFields.panel.radioGroup")}),e.jsx(N,{type:"text",value:t.group,onChange:r=>l({group:r.target.value})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:n("addFormFields.panel.radioGroupHint")})]}),e.jsxs("div",{children:[e.jsx(p,{children:n("addFormFields.panel.value")}),e.jsx(N,{type:"text",value:t.value,onChange:r=>l({value:r.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:"radio-selected",checked:t.selected||!1,onCheckedChange:r=>l({selected:r})}),e.jsx(p,{htmlFor:"radio-selected",className:"text-sm font-normal cursor-pointer",children:n("addFormFields.panel.selectedByDefault")})]})]}),t.type==="dropdown"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(p,{children:n("addFormFields.panel.options")}),e.jsx("textarea",{value:t.options.join(`
`),onChange:r=>l({options:r.target.value.split(`
`).filter(x=>x.trim())}),rows:5,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white text-sm focus:ring-2 focus:ring-ocean-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:"dropdown-multiselect",checked:t.multiSelect||!1,onCheckedChange:r=>l({multiSelect:r})}),e.jsx(p,{htmlFor:"dropdown-multiselect",className:"text-sm font-normal cursor-pointer",children:n("addFormFields.panel.allowMultiSelect")})]})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700 space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:"field-required",checked:t.required||!1,onCheckedChange:r=>l({required:r})}),e.jsx(p,{htmlFor:"field-required",className:"text-sm font-normal cursor-pointer",children:n("addFormFields.panel.requiredField")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{id:"field-readonly",checked:t.readonly||!1,onCheckedChange:r=>l({readonly:r})}),e.jsx(p,{htmlFor:"field-readonly",className:"text-sm font-normal cursor-pointer",children:n("addFormFields.panel.readOnlyField")})]})]})]})})};me.workerSrc=ie;const Re=()=>{const{t}=q(),{status:b}=se(),y=b==="pro"||b==="lifetime",{sharedFile:n,clearSharedFile:l,setSharedFile:r}=ae(),[x,_]=o.useState(null),[i,L]=o.useState(null),[w,T]=o.useState(!1),[P,U]=o.useState(!1),[C,$]=o.useState(null),[S,B]=o.useState(!1),[,F]=o.useState({percent:0,message:""}),[u,z]=o.useState([]),[M,R]=o.useState(null),[E,X]=o.useState(0),[O,a]=o.useState(0),[h,m]=o.useState(1);o.useEffect(()=>{if(n&&!x){const s=new File([n.blob],n.name,{type:"application/pdf"});j([s]),l()}},[n,x,l]),o.useEffect(()=>{if(i&&!P&&!w){const s=x?.name.replace(/\.pdf$/i,"_with_form.pdf")||"with_form.pdf";r(i,s,"add-form-fields-pdf"),T(!0)}},[i,P,w,x?.name,r]);const j=async s=>{const d=s[0];if(d){B(!0);try{const c=await d.arrayBuffer(),k=await ce({data:c}).promise;$(k);const W={id:`${Date.now()}`,file:d,name:d.name,size:d.size,status:"completed"};_(W),L(null),T(!1),z([]),R(null),X(0)}catch(c){console.error("Error loading PDF:",c)}finally{B(!1)}}},g=u.find(s=>s.id===M)||null,v=o.useCallback(s=>{const d={id:`field_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:s,name:`${s}_field_${u.length+1}`,x:100,y:100,width:s==="checkbox"||s==="radio"?20:200,height:s==="multiline"?80:20,page:E,...s==="dropdown"&&{options:t("addFormFields.panel.defaultOptions").split(`
`)},...s==="radio"&&{group:`radio_group_${u.filter(c=>c.type==="radio").length+1}`,value:t("addFormFields.panel.value")+" 1"}};z(c=>[...c,d]),R(d.id)},[E,u,t]),D=o.useCallback((s,d)=>{z(c=>c.map(k=>k.id===s?{...k,...d}:k))},[]),Y=o.useCallback(s=>{z(d=>d.filter(c=>c.id!==s)),M===s&&R(null)},[M]),A=o.useCallback(()=>{if(!M)return;const s=u.find(c=>c.id===M);if(!s)return;const d={...s,id:`field_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:`${s.name}_copy`,x:s.x+20,y:s.y+20};z(c=>[...c,d]),R(d.id)},[M,u]),I=o.useCallback((s,d,c)=>{D(s,{x:d,y:c})},[D]),V=o.useCallback((s,d,c)=>{D(s,{width:d,height:c})},[D]),G=o.useCallback(async()=>{if(!x?.file||u.length===0){alert(t("addFormFields.alertNoFields"));return}U(!0);try{const s=await ne(x.file,{fields:u,onProgress:(d,c)=>{F({percent:d,message:c})}});s.success&&s.data?L(s.data):alert("Error: "+(s.error?.message||"Unknown error"))}catch(s){console.error("Error saving PDF:",s),alert(t("common.error")+": "+(s instanceof Error?s.message:"Unknown error"))}finally{U(!1)}},[x,u,t,F]),J=async s=>{if(!i)return;let d=i;if(!y&&s)try{const W=await i.arrayBuffer(),te=await oe.applyWatermark(new Uint8Array(W));d=new Blob([new Uint8Array(te)],{type:"application/pdf"})}catch(W){console.error("Failed to apply watermark:",W)}const c=URL.createObjectURL(d),k=document.createElement("a");k.href=c,k.download=x?.name.replace(".pdf","_with_form.pdf")||"document_with_form.pdf",document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(c)},K=()=>{C&&C.destroy(),$(null),_(null),L(null),T(!1),z([]),R(null),X(0),a(0)},Q=()=>x?i?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-2 border-green-200 dark:border-green-800 rounded-2xl p-8",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 dark:bg-green-900/50 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(le,{className:"w-10 h-10 text-green-600 dark:text-green-400"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t("common.success")}),e.jsxs("div",{className:"text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsx("p",{children:t("addFormFields.addedCount",{count:u.length})}),e.jsx("p",{children:t("addFormFields.newSize",{size:(i.size/1024).toFixed(2)})})]})]})}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(xe,{toolId:"add-form-fields-pdf",onDownload:J,showWatermarkLabel:!y}),e.jsxs(f,{variant:"outline",onClick:K,className:"h-11 px-8 rounded-xl font-bold border-2",children:[e.jsx(RefreshCw,{className:"mr-2 h-4 w-4"}),t("common.processAnother")]})]})]}):e.jsxs("div",{className:"flex flex-col h-full space-y-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(pe,{currentPage:E,totalPages:O,scale:h,onPageChange:X,onScaleChange:m,onSave:G,onAddField:v,hideSave:!0})}),e.jsx("div",{className:"flex-1 flex flex-col min-h-[600px] bg-gray-100 dark:bg-gray-800 rounded-xl relative border border-gray-200 dark:border-gray-700 shadow-inner overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 overflow-auto scrollbar-thin scrollbar-thumb-gray-400 dark:scrollbar-thumb-gray-600",children:e.jsx("div",{className:"min-h-full flex items-center justify-center p-8",children:e.jsx(he,{pdfDocument:C,isDocumentLoading:S,currentPage:E,formFields:u,selectedFieldId:M,scale:h,onFieldSelect:R,onFieldMove:I,onFieldResize:V,onTotalPagesChange:a})})})}),e.jsxs("div",{className:"text-xs text-center text-gray-500",children:[t("addFormFields.fields",{count:u.length}),g&&` | ${t("addFormFields.selected",{name:g.name,type:t(`addFormFields.types.${g.type}`)})}`]})]}):null,Z=()=>g?e.jsxs("div",{className:"space-y-4",children:[e.jsx(ge,{selectedField:g,onFieldUpdate:D,onFieldDelete:Y}),e.jsxs(f,{variant:"outline",className:"w-full",onClick:A,children:[e.jsx(ue,{className:"w-4 h-4 mr-2"})," ",t("addFormFields.panel.duplicateField")]})]}):e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx("p",{children:t("addFormFields.selectFieldToEdit")}),e.jsx(f,{variant:"outline",size:"sm",className:"mt-4",onClick:()=>v("text"),children:t("addFormFields.addNewField")})]}),ee=()=>e.jsx(f,{onClick:G,disabled:P||!x||u.length===0,className:"w-full py-6 text-lg rounded-xl font-bold shadow-lg hover:shadow-xl transition-all",children:t(P?"common.processing":"addFormFields.toolbar.savePdf")});return e.jsx(de,{title:t("tools.add-form-fields-pdf.name"),description:t("tools.add-form-fields-pdf.description"),hasFiles:!!x,onUpload:j,isProcessing:P,maxFiles:1,uploadTitle:t("common.selectFile"),uploadDescription:t("upload.singleFileAllowed"),settings:i?null:Z(),actions:i?null:ee(),children:Q()})};export{Re as AddFormFieldsPDF};
